<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>memory_arena: Scratch Arena Pool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">memory_arena
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Scratch Arena Pool</div></div>
</div><!--header-->
<div class="contents">

<p>Public API for acquiring and releasing temporary memory arenas from a pool.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:arena__scratch_8c" id="r_arena__scratch_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="arena__scratch_8c.html">arena_scratch.c</a></td></tr>
<tr class="memdesc:arena__scratch_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of scratch arena pool system for temporary, fast, and reusable allocations. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:arena__scratch_8h" id="r_arena__scratch_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="arena__scratch_8h.html">arena_scratch.h</a></td></tr>
<tr class="memdesc:arena__scratch_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scratch arena pool system for fast, reusable temporary allocations. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structs__scratch__arena__pool" id="r_structs__scratch__arena__pool"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#structs__scratch__arena__pool">s_scratch_arena_pool</a></td></tr>
<tr class="memdesc:structs__scratch__arena__pool"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scratch arena pool structure holding multiple reusable memory arenas.  <a href="group__arena__scratch.html#structs__scratch__arena__pool">More...</a><br /></td></tr>
<tr class="separator:structs__scratch__arena__pool"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga88b1e6c61dcb7a9ba184aad63e1816f0" id="r_ga88b1e6c61dcb7a9ba184aad63e1816f0"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="group__arena__scratch.html#structs__scratch__arena__pool">s_scratch_arena_pool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a></td></tr>
<tr class="memdesc:ga88b1e6c61dcb7a9ba184aad63e1816f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scratch arena pool structure holding multiple reusable memory arenas.  <br /></td></tr>
<tr class="separator:ga88b1e6c61dcb7a9ba184aad63e1816f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga244f078e83929f392e441ca375c2230a" id="r_ga244f078e83929f392e441ca375c2230a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a">scratch_acquire</a> (<a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *pool)</td></tr>
<tr class="memdesc:ga244f078e83929f392e441ca375c2230a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire a temporary scratch arena from the pool.  <br /></td></tr>
<tr class="separator:ga244f078e83929f392e441ca375c2230a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga11827715e3ea2c02b2ddd7313bf7551c" id="r_ga11827715e3ea2c02b2ddd7313bf7551c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c">scratch_pool_destroy</a> (<a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *pool)</td></tr>
<tr class="memdesc:ga11827715e3ea2c02b2ddd7313bf7551c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy all arenas in a scratch pool and reset its metadata.  <br /></td></tr>
<tr class="separator:ga11827715e3ea2c02b2ddd7313bf7551c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaacf85b896eca809714ae5b80bce9b998" id="r_gaacf85b896eca809714ae5b80bce9b998"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#gaacf85b896eca809714ae5b80bce9b998">scratch_pool_init</a> (<a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *pool, size_t slot_size, bool thread_safe)</td></tr>
<tr class="memdesc:gaacf85b896eca809714ae5b80bce9b998"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a scratch arena pool with pre-allocated slots.  <br /></td></tr>
<tr class="separator:gaacf85b896eca809714ae5b80bce9b998"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gade0c7f0a1b88c47211db8f2c9f3f3660" id="r_gade0c7f0a1b88c47211db8f2c9f3f3660"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660">scratch_release</a> (<a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *pool, <a class="el" href="structt__arena.html">t_arena</a> *arena)</td></tr>
<tr class="memdesc:gade0c7f0a1b88c47211db8f2c9f3f3660"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release a scratch arena back to the pool for reuse.  <br /></td></tr>
<tr class="separator:gade0c7f0a1b88c47211db8f2c9f3f3660"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Public API for acquiring and releasing temporary memory arenas from a pool. </p>
<p>Scratch arenas are useful for high-frequency temporary allocations in performance-critical paths. These APIs support fast, reusable memory arenas from a preallocated pool with optional thread safety. </p>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structs__scratch__arena__pool" id="structs__scratch__arena__pool"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structs__scratch__arena__pool">&#9670;&#160;</a></span>s_scratch_arena_pool</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct s_scratch_arena_pool</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Scratch arena pool structure holding multiple reusable memory arenas. </p>
<p>This structure maintains a fixed number of scratch slots that can be individually acquired and reset for temporary memory needs. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#_a0">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8h_source.html#l00089">89</a> of file <a class="el" href="arena__scratch_8h_source.html">arena_scratch.h</a>.</p>
</div><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for s_scratch_arena_pool:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="structs__scratch__arena__pool__coll__graph.png" border="0" usemap="#as__scratch__arena__pool_coll__map" alt="Collaboration graph"/></div>
<map name="as__scratch__arena__pool_coll__map" id="as__scratch__arena__pool_coll__map">
<area shape="rect" title="Scratch arena pool structure holding multiple reusable memory arenas." alt="" coords="120,269,283,295"/>
<area shape="rect" href="group__arena__scratch__internal.html#structs__scratch__slot" title="Represents a single slot in the scratch arena pool." alt="" coords="144,181,259,207"/>
<area shape="poly" title=" " alt="" coords="204,221,204,269,199,269,199,221"/>
<area shape="rect" href="structs__arena.html" title=" " alt="" coords="165,93,238,119"/>
<area shape="poly" title=" " alt="" coords="204,133,204,181,199,181,199,133"/>
<area shape="poly" title=" " alt="" coords="252,96,261,100,265,106,256,115,238,117,238,111,254,110,259,106,257,104,251,102"/>
<area shape="rect" href="group__arena__stats.html#structs__arena__stats" title="Structure holding runtime statistics for an arena." alt="" coords="5,5,117,31"/>
<area shape="poly" title=" " alt="" coords="93,36,184,91,181,95,91,40"/>
<area shape="rect" href="structs__arena__debug.html" title="Debug metadata associated with an arena." alt="" coords="141,5,261,31"/>
<area shape="poly" title=" " alt="" coords="204,45,204,93,199,93,199,45"/>
<area shape="rect" href="structs__arena__hooks.html" title="Internal structure for managing arena hooks." alt="" coords="286,5,405,31"/>
<area shape="poly" title=" " alt="" coords="316,40,222,95,220,91,313,35"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr><td colspan="2"><h3>Data Fields</h3></td></tr>
<tr class="memitem:a6504b8d51c2b438853b18f89cb70d9a0" id="r_a6504b8d51c2b438853b18f89cb70d9a0"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#a6504b8d51c2b438853b18f89cb70d9a0">lock</a></td></tr>
<tr class="memdesc:a6504b8d51c2b438853b18f89cb70d9a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex for protecting slot access.  <br /></td></tr>
<tr class="separator:a6504b8d51c2b438853b18f89cb70d9a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64c052156b441b7adf46af210b8fcf95" id="r_a64c052156b441b7adf46af210b8fcf95"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#a64c052156b441b7adf46af210b8fcf95">slot_size</a></td></tr>
<tr class="memdesc:a64c052156b441b7adf46af210b8fcf95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Size of each arena in bytes.  <br /></td></tr>
<tr class="separator:a64c052156b441b7adf46af210b8fcf95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa36226e6da3d33e85c2f2bbebce6585c" id="r_aa36226e6da3d33e85c2f2bbebce6585c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__arena__scratch__internal.html#ga03e5b293bcec1c3113dc3b9a103f8d3b">t_scratch_slot</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a> [<a class="el" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>]</td></tr>
<tr class="memdesc:aa36226e6da3d33e85c2f2bbebce6585c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array of scratch slots.  <br /></td></tr>
<tr class="separator:aa36226e6da3d33e85c2f2bbebce6585c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af715e967b0a60c4da8500be7d3ac7ca3" id="r_af715e967b0a60c4da8500be7d3ac7ca3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__scratch.html#af715e967b0a60c4da8500be7d3ac7ca3">thread_safe</a></td></tr>
<tr class="memdesc:af715e967b0a60c4da8500be7d3ac7ca3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether locking is enabled.  <br /></td></tr>
<tr class="separator:af715e967b0a60c4da8500be7d3ac7ca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h4 class="groupheader">Field Documentation</h4>
<a id="a6504b8d51c2b438853b18f89cb70d9a0" name="a6504b8d51c2b438853b18f89cb70d9a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6504b8d51c2b438853b18f89cb70d9a0">&#9670;&#160;</a></span>lock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t s_scratch_arena_pool::lock</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mutex for protecting slot access. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a12">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8h_source.html#l00094">94</a> of file <a class="el" href="arena__scratch_8h_source.html">arena_scratch.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__scratch_8c_source.html#l00302">scratch_pool_destroy()</a>, and <a class="el" href="arena__scratch_8c_source.html#l00249">scratch_pool_init()</a>.</p>

</div>
</div>
<a id="a64c052156b441b7adf46af210b8fcf95" name="a64c052156b441b7adf46af210b8fcf95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64c052156b441b7adf46af210b8fcf95">&#9670;&#160;</a></span>slot_size</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t s_scratch_arena_pool::slot_size</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Size of each arena in bytes. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a10">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8h_source.html#l00092">92</a> of file <a class="el" href="arena__scratch_8h_source.html">arena_scratch.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__scratch_8c_source.html#l00249">scratch_pool_init()</a>.</p>

</div>
</div>
<a id="aa36226e6da3d33e85c2f2bbebce6585c" name="aa36226e6da3d33e85c2f2bbebce6585c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa36226e6da3d33e85c2f2bbebce6585c">&#9670;&#160;</a></span>slots</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__arena__scratch__internal.html#ga03e5b293bcec1c3113dc3b9a103f8d3b">t_scratch_slot</a> s_scratch_arena_pool::slots[<a class="el" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Array of scratch slots. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a14">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8h_source.html#l00091">91</a> of file <a class="el" href="arena__scratch_8h_source.html">arena_scratch.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__scratch_8c_source.html#l00350">scratch_acquire()</a>, <a class="el" href="arena__scratch_8c_source.html#l00302">scratch_pool_destroy()</a>, <a class="el" href="arena__scratch_8c_source.html#l00249">scratch_pool_init()</a>, and <a class="el" href="arena__scratch_8c_source.html#l00398">scratch_release()</a>.</p>

</div>
</div>
<a id="af715e967b0a60c4da8500be7d3ac7ca3" name="af715e967b0a60c4da8500be7d3ac7ca3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af715e967b0a60c4da8500be7d3ac7ca3">&#9670;&#160;</a></span>thread_safe</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool s_scratch_arena_pool::thread_safe</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Whether locking is enabled. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a11">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8h_source.html#l00093">93</a> of file <a class="el" href="arena__scratch_8h_source.html">arena_scratch.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__scratch_8c_source.html#l00302">scratch_pool_destroy()</a>, and <a class="el" href="arena__scratch_8c_source.html#l00249">scratch_pool_init()</a>.</p>

</div>
</div>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ga88b1e6c61dcb7a9ba184aad63e1816f0" name="ga88b1e6c61dcb7a9ba184aad63e1816f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga88b1e6c61dcb7a9ba184aad63e1816f0">&#9670;&#160;</a></span>t_scratch_arena_pool</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="group__arena__scratch.html#structs__scratch__arena__pool">s_scratch_arena_pool</a> <a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__scratch_8h.html">arena_scratch.h</a>&gt;</code></p>

<p>Scratch arena pool structure holding multiple reusable memory arenas. </p>
<p>This structure maintains a fixed number of scratch slots that can be individually acquired and reset for temporary memory needs. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga244f078e83929f392e441ca375c2230a" name="ga244f078e83929f392e441ca375c2230a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga244f078e83929f392e441ca375c2230a">&#9670;&#160;</a></span>scratch_acquire()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structt__arena.html">t_arena</a> * scratch_acquire </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__scratch_8h.html">arena_scratch.h</a>&gt;</code></p>

<p>Acquire a temporary scratch arena from the pool. </p>
<p>This function returns a pointer to a scratch arena from the given pool that is currently available (i.e., not in use). Internally, it scans the pool’s slots and uses an atomic flag to claim one safely, even in multithreaded contexts.</p>
<p>Upon successful acquisition:</p><ul>
<li>The arena is marked as in-use via <code>atomic_exchange()</code>.</li>
<li>Its memory is cleared using <code><a class="el" href="arena_8h.html#a1a2582ca5fb4e571ac150fbd77bd0d82">arena_reset()</a></code> before returning.</li>
</ul>
<p>If no arenas are available, the function returns <code>NULL</code> and reports an error. This may happen when all slots are concurrently in use or exhausted.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>Pointer to the scratch arena pool to acquire from.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to a <code><a class="el" href="structt__arena.html" title="The main memory arena structure used for fast allocation.">t_arena</a></code> if one is available, or <code>NULL</code> on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The returned arena must be released using <code><a class="el" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660" title="Release a scratch arena back to the pool for reuse.">scratch_release()</a></code> when no longer needed.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The arena is not thread-safe by default. Do not use the same scratch slot concurrently without external synchronization.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660" title="Release a scratch arena back to the pool for reuse.">scratch_release</a> </dd>
<dd>
<a class="el" href="arena_8h.html#a1a2582ca5fb4e571ac150fbd77bd0d82">arena_reset</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a2">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8c_source.html#l00350">350</a> of file <a class="el" href="arena__scratch_8c_source.html">arena_scratch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  351</span>{</div>
<div class="line"><span class="lineno">  352</span>    <span class="keywordflow">if</span> (!pool)</div>
<div class="line"><span class="lineno">  353</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_acquire failed: pool is NULL&quot;</span>), NULL;</div>
<div class="line"><span class="lineno">  354</span> </div>
<div class="line"><span class="lineno">  355</span>    <a class="code hl_define" href="arena__scratch_8h.html#abce4c0e1d69d3b9850e36d69968c2d64">SCRATCH_LOCK</a>(pool);</div>
<div class="line"><span class="lineno">  356</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line"><span class="lineno">  357</span>    {</div>
<div class="line"><span class="lineno">  358</span>        <span class="keywordflow">if</span> (!atomic_exchange(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a52279bc596790848ee8b4c00064f3782">in_use</a>, <span class="keyword">true</span>))</div>
<div class="line"><span class="lineno">  359</span>        {</div>
<div class="line"><span class="lineno">  360</span>            <a class="code hl_function" href="arena_8h.html#a1a2582ca5fb4e571ac150fbd77bd0d82">arena_reset</a>(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a>);</div>
<div class="line"><span class="lineno">  361</span>            <a class="code hl_define" href="arena__scratch_8h.html#a2f8510d38c4a460a6defc40c47e197dd">SCRATCH_UNLOCK</a>(pool);</div>
<div class="line"><span class="lineno">  362</span>            <span class="keywordflow">return</span> &amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a>;</div>
<div class="line"><span class="lineno">  363</span>        }</div>
<div class="line"><span class="lineno">  364</span>    }</div>
<div class="line"><span class="lineno">  365</span>    <a class="code hl_define" href="arena__scratch_8h.html#a2f8510d38c4a460a6defc40c47e197dd">SCRATCH_UNLOCK</a>(pool);</div>
<div class="line"><span class="lineno">  366</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_acquire failed: all slots in use&quot;</span>), NULL;</div>
<div class="line"><span class="lineno">  367</span>}</div>
<div class="ttc" id="aarena_8h_html_a1a2582ca5fb4e571ac150fbd77bd0d82"><div class="ttname"><a href="arena_8h.html#a1a2582ca5fb4e571ac150fbd77bd0d82">arena_reset</a></div><div class="ttdeci">void arena_reset(t_arena *arena)</div><div class="ttdef"><b>Definition</b> <a href="arena__state_8c_source.html#l00345">arena_state.c:345</a></div></div>
<div class="ttc" id="aarena__debug_8h_html_ad19e051bc49dc6b6dcda0f31561e222d"><div class="ttname"><a href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a></div><div class="ttdeci">void arena_report_error(t_arena *arena, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="arena__debug_8c_source.html#l00253">arena_debug.c:253</a></div></div>
<div class="ttc" id="aarena__scratch_8h_html_a2f8510d38c4a460a6defc40c47e197dd"><div class="ttname"><a href="arena__scratch_8h.html#a2f8510d38c4a460a6defc40c47e197dd">SCRATCH_UNLOCK</a></div><div class="ttdeci">#define SCRATCH_UNLOCK(pool)</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00055">arena_scratch.h:55</a></div></div>
<div class="ttc" id="aarena__scratch_8h_html_a7896fb10ff84dd7be54082cf4c301829"><div class="ttname"><a href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a></div><div class="ttdeci">#define SCRATCH_MAX_SLOTS</div><div class="ttdoc">Maximum number of concurrently usable scratch arenas in the pool.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00041">arena_scratch.h:41</a></div></div>
<div class="ttc" id="aarena__scratch_8h_html_abce4c0e1d69d3b9850e36d69968c2d64"><div class="ttname"><a href="arena__scratch_8h.html#abce4c0e1d69d3b9850e36d69968c2d64">SCRATCH_LOCK</a></div><div class="ttdeci">#define SCRATCH_LOCK(pool)</div><div class="ttdoc">Thread-safe locking macro (enabled only if ARENA_ENABLE_THREAD_SAFE is set)</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00054">arena_scratch.h:54</a></div></div>
<div class="ttc" id="agroup__arena__scratch__internal_html_a52279bc596790848ee8b4c00064f3782"><div class="ttname"><a href="group__arena__scratch__internal.html#a52279bc596790848ee8b4c00064f3782">s_scratch_slot::in_use</a></div><div class="ttdeci">atomic_bool in_use</div><div class="ttdoc">Atomic flag for acquisition tracking.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00076">arena_scratch.h:76</a></div></div>
<div class="ttc" id="agroup__arena__scratch__internal_html_a8e53aefa580a0552977802026307e540"><div class="ttname"><a href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">s_scratch_slot::arena</a></div><div class="ttdeci">t_arena arena</div><div class="ttdoc">Memory arena associated with this slot.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00075">arena_scratch.h:75</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_aa36226e6da3d33e85c2f2bbebce6585c"><div class="ttname"><a href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">s_scratch_arena_pool::slots</a></div><div class="ttdeci">t_scratch_slot slots[SCRATCH_MAX_SLOTS]</div><div class="ttdoc">Array of scratch slots.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00091">arena_scratch.h:91</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__scratch_8h_source.html#l00075">s_scratch_slot::arena</a>, <a class="el" href="arena__debug_8c_source.html#l00253">arena_report_error()</a>, <a class="el" href="arena__state_8c_source.html#l00345">arena_reset()</a>, <a class="el" href="arena__scratch_8h_source.html#l00076">s_scratch_slot::in_use</a>, <a class="el" href="arena__scratch_8h_source.html#l00054">SCRATCH_LOCK</a>, <a class="el" href="arena__scratch_8h_source.html#l00041">SCRATCH_MAX_SLOTS</a>, <a class="el" href="arena__scratch_8h_source.html#l00055">SCRATCH_UNLOCK</a>, and <a class="el" href="arena__scratch_8h_source.html#l00091">s_scratch_arena_pool::slots</a>.</p>

</div>
</div>
<a id="ga11827715e3ea2c02b2ddd7313bf7551c" name="ga11827715e3ea2c02b2ddd7313bf7551c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga11827715e3ea2c02b2ddd7313bf7551c">&#9670;&#160;</a></span>scratch_pool_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scratch_pool_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__scratch_8h.html">arena_scratch.h</a>&gt;</code></p>

<p>Destroy all arenas in a scratch pool and reset its metadata. </p>
<p>This function deinitializes all scratch arenas in the pool by calling <code><a class="el" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy()</a></code> on each slot. If the pool was initialized as thread-safe, it also destroys the associated mutex.</p>
<p>After cleanup, the pool's memory is zeroed out using <code>memset</code> to prevent accidental reuse or access to invalidated arenas.</p>
<p>This function must be called before deallocating or discarding a scratch pool, especially in cases where initialization (<code>scratch_pool_init</code>) succeeded only partially or the pool is no longer needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>Pointer to the scratch arena pool to destroy.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function is idempotent: calling it on a <code>NULL</code> pool is safe and has no effect.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__arena__scratch.html#gaacf85b896eca809714ae5b80bce9b998" title="Initialize a scratch arena pool with pre-allocated slots.">scratch_pool_init</a> </dd>
<dd>
<a class="el" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a6">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8c_source.html#l00302">302</a> of file <a class="el" href="arena__scratch_8c_source.html">arena_scratch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  303</span>{</div>
<div class="line"><span class="lineno">  304</span>    <span class="keywordflow">if</span> (!pool)</div>
<div class="line"><span class="lineno">  305</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line"><span class="lineno">  308</span>        <a class="code hl_function" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a>(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a>);</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line"><span class="lineno">  311</span>    <span class="keywordflow">if</span> (pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#af715e967b0a60c4da8500be7d3ac7ca3">thread_safe</a>)</div>
<div class="line"><span class="lineno">  312</span>        pthread_mutex_destroy(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#a6504b8d51c2b438853b18f89cb70d9a0">lock</a>);</div>
<div class="line"><span class="lineno">  313</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  314</span> </div>
<div class="line"><span class="lineno">  315</span>    memset(pool, 0, <span class="keyword">sizeof</span>(*pool));</div>
<div class="line"><span class="lineno">  316</span>}</div>
<div class="ttc" id="aarena_8h_html_a640f54190aa0b356bc55787bfde1dcc5"><div class="ttname"><a href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a></div><div class="ttdeci">void arena_destroy(t_arena *arena)</div><div class="ttdef"><b>Definition</b> <a href="arena__cleanup_8c_source.html#l00082">arena_cleanup.c:82</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_a6504b8d51c2b438853b18f89cb70d9a0"><div class="ttname"><a href="group__arena__scratch.html#a6504b8d51c2b438853b18f89cb70d9a0">s_scratch_arena_pool::lock</a></div><div class="ttdeci">pthread_mutex_t lock</div><div class="ttdoc">Mutex for protecting slot access.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00094">arena_scratch.h:94</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_af715e967b0a60c4da8500be7d3ac7ca3"><div class="ttname"><a href="group__arena__scratch.html#af715e967b0a60c4da8500be7d3ac7ca3">s_scratch_arena_pool::thread_safe</a></div><div class="ttdeci">bool thread_safe</div><div class="ttdoc">Whether locking is enabled.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00093">arena_scratch.h:93</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__scratch_8h_source.html#l00075">s_scratch_slot::arena</a>, <a class="el" href="arena__cleanup_8c_source.html#l00082">arena_destroy()</a>, <a class="el" href="arena__scratch_8h_source.html#l00094">s_scratch_arena_pool::lock</a>, <a class="el" href="arena__scratch_8h_source.html#l00041">SCRATCH_MAX_SLOTS</a>, <a class="el" href="arena__scratch_8h_source.html#l00091">s_scratch_arena_pool::slots</a>, and <a class="el" href="arena__scratch_8h_source.html#l00093">s_scratch_arena_pool::thread_safe</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__scratch_8c_source.html#l00249">scratch_pool_init()</a>.</p>

</div>
</div>
<a id="gaacf85b896eca809714ae5b80bce9b998" name="gaacf85b896eca809714ae5b80bce9b998"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaacf85b896eca809714ae5b80bce9b998">&#9670;&#160;</a></span>scratch_pool_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool scratch_pool_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>slot_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>thread_safe</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__scratch_8h.html">arena_scratch.h</a>&gt;</code></p>

<p>Initialize a scratch arena pool with pre-allocated slots. </p>
<p>This function sets up a reusable pool of scratch arenas, each initialized to the same <code>slot_size</code>. It prepares the internal array of slots, resets metadata, and (if enabled) configures a mutex for thread safety.</p>
<p>For each slot:</p><ul>
<li>An arena is initialized with the specified <code>slot_size</code>.</li>
<li>The slot is marked as not in use.</li>
</ul>
<p>If any arena initialization fails, the entire pool is destroyed via <code><a class="el" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c" title="Destroy all arenas in a scratch pool and reset its metadata.">scratch_pool_destroy()</a></code> and the function returns <code>false</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>Pointer to the scratch pool structure to initialize. </td></tr>
    <tr><td class="paramname">slot_size</td><td>Size of each individual scratch arena (in bytes). </td></tr>
    <tr><td class="paramname">thread_safe</td><td>If <code>true</code>, enables mutex-based locking for slot access.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the pool was successfully initialized, <code>false</code> otherwise.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>All arenas in the pool are marked as growable by default.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>You must call <code><a class="el" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c" title="Destroy all arenas in a scratch pool and reset its metadata.">scratch_pool_destroy()</a></code> to clean up the pool before deallocating it.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__arena__scratch__internal.html#gae37e23cb6b3d190982157208a850d840" title="Initialize a single scratch slot with its own arena.">scratch_slot_init</a> </dd>
<dd>
<a class="el" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c" title="Destroy all arenas in a scratch pool and reset its metadata.">scratch_pool_destroy</a> </dd>
<dd>
<a class="el" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a" title="Acquire a temporary scratch arena from the pool.">scratch_acquire</a> </dd>
<dd>
<a class="el" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660" title="Release a scratch arena back to the pool for reuse.">scratch_release</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a5">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8c_source.html#l00249">249</a> of file <a class="el" href="arena__scratch_8c_source.html">arena_scratch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  250</span>{</div>
<div class="line"><span class="lineno">  251</span>    <span class="keywordflow">if</span> (!pool || slot_size == 0)</div>
<div class="line"><span class="lineno">  252</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_pool_init failed: invalid arguments&quot;</span>), <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>    memset(pool, 0, <span class="keyword">sizeof</span>(*pool));</div>
<div class="line"><span class="lineno">  255</span>    pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#a64c052156b441b7adf46af210b8fcf95">slot_size</a>   = slot_size;</div>
<div class="line"><span class="lineno">  256</span>    pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#af715e967b0a60c4da8500be7d3ac7ca3">thread_safe</a> = thread_safe;</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line"><span class="lineno">  259</span>    <span class="keywordflow">if</span> (thread_safe)</div>
<div class="line"><span class="lineno">  260</span>        pthread_mutex_init(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#a6504b8d51c2b438853b18f89cb70d9a0">lock</a>, NULL);</div>
<div class="line"><span class="lineno">  261</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  262</span> </div>
<div class="line"><span class="lineno">  263</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line"><span class="lineno">  264</span>    {</div>
<div class="line"><span class="lineno">  265</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__scratch__internal.html#gae37e23cb6b3d190982157208a850d840">scratch_slot_init</a>(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i], slot_size, i))</div>
<div class="line"><span class="lineno">  266</span>        {</div>
<div class="line"><span class="lineno">  267</span>            <a class="code hl_function" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c">scratch_pool_destroy</a>(pool);</div>
<div class="line"><span class="lineno">  268</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  269</span>        }</div>
<div class="line"><span class="lineno">  270</span>    }</div>
<div class="line"><span class="lineno">  271</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  272</span>}</div>
<div class="ttc" id="agroup__arena__scratch__internal_html_gae37e23cb6b3d190982157208a850d840"><div class="ttname"><a href="group__arena__scratch__internal.html#gae37e23cb6b3d190982157208a850d840">scratch_slot_init</a></div><div class="ttdeci">static bool scratch_slot_init(t_scratch_slot *slot, size_t slot_size, int index)</div><div class="ttdoc">Initialize a single scratch slot with its own arena.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8c_source.html#l00449">arena_scratch.c:449</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_a64c052156b441b7adf46af210b8fcf95"><div class="ttname"><a href="group__arena__scratch.html#a64c052156b441b7adf46af210b8fcf95">s_scratch_arena_pool::slot_size</a></div><div class="ttdeci">size_t slot_size</div><div class="ttdoc">Size of each arena in bytes.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00092">arena_scratch.h:92</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_ga11827715e3ea2c02b2ddd7313bf7551c"><div class="ttname"><a href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c">scratch_pool_destroy</a></div><div class="ttdeci">void scratch_pool_destroy(t_scratch_arena_pool *pool)</div><div class="ttdoc">Destroy all arenas in a scratch pool and reset its metadata.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8c_source.html#l00302">arena_scratch.c:302</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__debug_8c_source.html#l00253">arena_report_error()</a>, <a class="el" href="arena__scratch_8h_source.html#l00094">s_scratch_arena_pool::lock</a>, <a class="el" href="arena__scratch_8h_source.html#l00041">SCRATCH_MAX_SLOTS</a>, <a class="el" href="arena__scratch_8c_source.html#l00302">scratch_pool_destroy()</a>, <a class="el" href="arena__scratch_8c_source.html#l00449">scratch_slot_init()</a>, <a class="el" href="arena__scratch_8h_source.html#l00092">s_scratch_arena_pool::slot_size</a>, <a class="el" href="arena__scratch_8h_source.html#l00091">s_scratch_arena_pool::slots</a>, and <a class="el" href="arena__scratch_8h_source.html#l00093">s_scratch_arena_pool::thread_safe</a>.</p>

</div>
</div>
<a id="gade0c7f0a1b88c47211db8f2c9f3f3660" name="gade0c7f0a1b88c47211db8f2c9f3f3660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gade0c7f0a1b88c47211db8f2c9f3f3660">&#9670;&#160;</a></span>scratch_release()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scratch_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__arena__scratch.html#ga88b1e6c61dcb7a9ba184aad63e1816f0">t_scratch_arena_pool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__scratch_8h.html">arena_scratch.h</a>&gt;</code></p>

<p>Release a scratch arena back to the pool for reuse. </p>
<p>This function marks a previously acquired scratch arena as available again. It searches the pool’s slots for a match with the provided arena pointer, and clears the <code>in_use</code> flag using <code>atomic_store()</code>.</p>
<p>This allows the arena to be reused by future calls to <code><a class="el" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a" title="Acquire a temporary scratch arena from the pool.">scratch_acquire()</a></code>.</p>
<p>If the provided arena does not match any slot in the pool, the function logs an error via <code><a class="el" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error()</a></code> and does nothing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>Pointer to the scratch pool the arena belongs to. </td></tr>
    <tr><td class="paramname">arena</td><td>Pointer to the arena to release.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>It is safe to call this function multiple times with the same arena, but doing so without matching <code><a class="el" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a" title="Acquire a temporary scratch arena from the pool.">scratch_acquire()</a></code> calls may cause logic errors.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The arena must have been obtained from the same pool via <code><a class="el" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a" title="Acquire a temporary scratch arena from the pool.">scratch_acquire()</a></code>. Passing an invalid or mismatched pointer results in an error.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a" title="Acquire a temporary scratch arena from the pool.">scratch_acquire</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_scratch_8c-example.html#a4">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__scratch_8c_source.html#l00398">398</a> of file <a class="el" href="arena__scratch_8c_source.html">arena_scratch.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  399</span>{</div>
<div class="line"><span class="lineno">  400</span>    <span class="keywordflow">if</span> (!pool || !arena)</div>
<div class="line"><span class="lineno">  401</span>    {</div>
<div class="line"><span class="lineno">  402</span>        <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_release failed: null pool or arena&quot;</span>);</div>
<div class="line"><span class="lineno">  403</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  404</span>    }</div>
<div class="line"><span class="lineno">  405</span> </div>
<div class="line"><span class="lineno">  406</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line"><span class="lineno">  407</span>    {</div>
<div class="line"><span class="lineno">  408</span>        <span class="keywordflow">if</span> (&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a> == arena)</div>
<div class="line"><span class="lineno">  409</span>        {</div>
<div class="line"><span class="lineno">  410</span>            atomic_store(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a52279bc596790848ee8b4c00064f3782">in_use</a>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  411</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  412</span>        }</div>
<div class="line"><span class="lineno">  413</span>    }</div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>    <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(arena, <span class="stringliteral">&quot;scratch_release failed: arena not found in pool&quot;</span>);</div>
<div class="line"><span class="lineno">  416</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__scratch_8h_source.html#l00075">s_scratch_slot::arena</a>, <a class="el" href="arena__debug_8c_source.html#l00253">arena_report_error()</a>, <a class="el" href="arena__scratch_8h_source.html#l00076">s_scratch_slot::in_use</a>, <a class="el" href="arena__scratch_8h_source.html#l00041">SCRATCH_MAX_SLOTS</a>, and <a class="el" href="arena__scratch_8h_source.html#l00091">s_scratch_arena_pool::slots</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
