<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>memory_arena: arena_cleanup.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">memory_arena
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b73b02d482d1c4a3db20c3d9ad52d395.html">srcs</a></li><li class="navelem"><a class="el" href="dir_17861ed4715c21a45f8ebd24780ab7d4.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">arena_cleanup.c File Reference<div class="ingroups"><a class="el" href="group__arena__cleanup.html">Arena Cleanup</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Cleanup and teardown routines for memory arenas.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="arena_8h_source.html">arena.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for arena_cleanup.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="arena__cleanup_8c__incl.png" border="0" usemap="#aarena__cleanup_8c" alt=""/></div>
<map name="aarena__cleanup_8c" id="aarena__cleanup_8c">
<area shape="rect" title="Cleanup and teardown routines for memory arenas." alt="" coords="442,5,570,31"/>
<area shape="rect" href="arena_8h.html" title="Core public API for the Arena memory allocator." alt="" coords="471,79,541,104"/>
<area shape="poly" title=" " alt="" coords="509,31,509,65,503,65,503,31"/>
<area shape="rect" title=" " alt="" coords="5,152,76,177"/>
<area shape="poly" title=" " alt="" coords="471,99,310,119,90,154,89,149,309,114,470,94"/>
<area shape="rect" title=" " alt="" coords="100,152,171,177"/>
<area shape="poly" title=" " alt="" coords="471,101,185,155,184,149,470,96"/>
<area shape="rect" href="arena__debug_8h.html" title="Debugging utilities and hooks for the arena memory allocator." alt="" coords="337,152,509,177"/>
<area shape="poly" title=" " alt="" coords="494,106,449,145,446,141,491,102"/>
<area shape="rect" href="arena__hooks_8h.html" title="Allocation hook system for arena&#45;based memory tracking and introspection." alt="" coords="195,152,313,177"/>
<area shape="poly" title=" " alt="" coords="471,105,309,151,307,146,470,100"/>
<area shape="rect" href="arena__internal_8h.html" title="Internal utilities and helpers for arena memory management." alt="" coords="859,152,1041,177"/>
<area shape="poly" title=" " alt="" coords="542,97,859,147,858,153,541,102"/>
<area shape="rect" href="arena__math_8h.html" title="Math utility functions for memory alignment and overflow&#45;safe arithmetic." alt="" coords="668,152,835,177"/>
<area shape="poly" title=" " alt="" coords="542,100,699,146,698,151,541,106"/>
<area shape="rect" href="arena__stats_8h.html" title="Runtime statistics tracking and diagnostics for memory arenas." alt="" coords="533,152,644,177"/>
<area shape="poly" title=" " alt="" coords="521,102,566,141,563,145,518,106"/>
<area shape="rect" href="arena__config_8h.html" title=" " alt="" coords="401,225,518,251"/>
<area shape="poly" title=" " alt="" coords="432,176,450,212,445,214,427,179"/>
<area shape="rect" title=" " alt="" coords="302,225,377,251"/>
<area shape="poly" title=" " alt="" coords="412,179,365,218,362,214,408,175"/>
<area shape="rect" title=" " alt="" coords="179,225,278,251"/>
<area shape="poly" title=" " alt="" coords="393,180,274,223,272,218,391,175"/>
<area shape="rect" title=" " alt="" coords="729,225,803,251"/>
<area shape="poly" title=" " alt="" coords="482,175,716,222,715,228,481,180"/>
<area shape="rect" title=" " alt="" coords="633,225,704,251"/>
<area shape="poly" title=" " alt="" coords="463,175,621,220,620,225,462,180"/>
<area shape="rect" title=" " alt="" coords="542,225,609,251"/>
<area shape="poly" title=" " alt="" coords="449,175,539,217,537,222,447,180"/>
<area shape="poly" title=" " alt="" coords="252,179,240,213,235,212,247,177"/>
<area shape="poly" title=" " alt="" coords="885,155,555,102,555,97,886,149"/>
<area shape="poly" title=" " alt="" coords="921,180,810,223,808,218,919,175"/>
<area shape="rect" title=" " alt="" coords="861,225,943,251"/>
<area shape="poly" title=" " alt="" coords="944,179,920,216,915,213,940,176"/>
<area shape="poly" title=" " alt="" coords="756,177,763,211,758,212,751,178"/>
<area shape="poly" title=" " alt="" coords="740,179,694,218,691,214,736,175"/>
<area shape="poly" title=" " alt="" coords="777,175,866,217,864,222,774,180"/>
<area shape="poly" title=" " alt="" coords="618,175,726,218,724,223,616,180"/>
<area shape="poly" title=" " alt="" coords="589,178,583,212,577,211,584,177"/>
</map>
</div>
</div>
<p><a href="arena__cleanup_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7821a62eaf6d9f982322e49eaf6153e8" id="r_a7821a62eaf6d9f982322e49eaf6153e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="arena__cleanup_8c.html#a7821a62eaf6d9f982322e49eaf6153e8">arena_delete</a> (<a class="el" href="structt__arena.html">t_arena</a> **arena)</td></tr>
<tr class="separator:a7821a62eaf6d9f982322e49eaf6153e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a640f54190aa0b356bc55787bfde1dcc5" id="r_a640f54190aa0b356bc55787bfde1dcc5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="arena__cleanup_8c.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena)</td></tr>
<tr class="separator:a640f54190aa0b356bc55787bfde1dcc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga10136f5110cb80cb4d54d4a3ff23419f" id="r_ga10136f5110cb80cb4d54d4a3ff23419f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__cleanup__internal.html#ga10136f5110cb80cb4d54d4a3ff23419f">arena_free_buffer_if_owned</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena)</td></tr>
<tr class="memdesc:ga10136f5110cb80cb4d54d4a3ff23419f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the arena's internal buffer if the arena owns it.  <br /></td></tr>
<tr class="separator:ga10136f5110cb80cb4d54d4a3ff23419f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga46d3cb036c51fdf0f6f3cad6d0fcc3a6" id="r_ga46d3cb036c51fdf0f6f3cad6d0fcc3a6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__cleanup__internal.html#ga46d3cb036c51fdf0f6f3cad6d0fcc3a6">arena_free_growth_history</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena)</td></tr>
<tr class="memdesc:ga46d3cb036c51fdf0f6f3cad6d0fcc3a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the memory used to store the arena's growth history.  <br /></td></tr>
<tr class="separator:ga46d3cb036c51fdf0f6f3cad6d0fcc3a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Cleanup and teardown routines for memory arenas. </p>
<dl class="section author"><dt>Author</dt><dd>Toonsa </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025</dd></dl>
<p>This file provides functions to safely destroy and deallocate arena resources, including internal memory buffers, metadata like growth history, and synchronization primitives. It ensures proper cleanup whether the arena is heap-allocated or stack-allocated.</p>
<p>API functions included:</p><ul>
<li>Thread-safe destruction (<code>arena_destroy</code>)</li>
<li>Full arena deletion (<code>arena_delete</code>)</li>
</ul>
<p>These functions are used internally and publicly to manage arena lifecycles and to ensure memory safety, thread-safety, and diagnostic cleanliness. </p>

<p class="definition">Definition in file <a class="el" href="arena__cleanup_8c_source.html">arena_cleanup.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7821a62eaf6d9f982322e49eaf6153e8" name="a7821a62eaf6d9f982322e49eaf6153e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7821a62eaf6d9f982322e49eaf6153e8">&#9670;&#160;</a></span>arena_delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void arena_delete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> **&#160;</td>
          <td class="paramname"><em>arena</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="arena__cleanup_8c_source.html#l00148">148</a> of file <a class="el" href="arena__cleanup_8c_source.html">arena_cleanup.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  149</span>{</div>
<div class="line"><span class="lineno">  150</span>    <span class="keywordflow">if</span> (!arena || !*arena)</div>
<div class="line"><span class="lineno">  151</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  152</span> </div>
<div class="line"><span class="lineno">  153</span>    <a class="code hl_function" href="arena__cleanup_8c.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a>(*arena);</div>
<div class="line"><span class="lineno">  154</span>    free(*arena);</div>
<div class="line"><span class="lineno">  155</span>    *arena = NULL;</div>
<div class="line"><span class="lineno">  156</span>}</div>
<div class="ttc" id="aarena__cleanup_8c_html_a640f54190aa0b356bc55787bfde1dcc5"><div class="ttname"><a href="arena__cleanup_8c.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a></div><div class="ttdeci">void arena_destroy(t_arena *arena)</div><div class="ttdef"><b>Definition</b> <a href="arena__cleanup_8c_source.html#l00082">arena_cleanup.c:82</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__cleanup_8c_source.html#l00082">arena_destroy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__create_8c_source.html#l00458">arena_log_and_teardown()</a>.</p>

</div>
</div>
<a id="a640f54190aa0b356bc55787bfde1dcc5" name="a640f54190aa0b356bc55787bfde1dcc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a640f54190aa0b356bc55787bfde1dcc5">&#9670;&#160;</a></span>arena_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void arena_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="arena__cleanup_8c_source.html#l00082">82</a> of file <a class="el" href="arena__cleanup_8c_source.html">arena_cleanup.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   83</span>{</div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">if</span> (!arena)</div>
<div class="line"><span class="lineno">   85</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    <span class="keywordtype">bool</span> expected = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   88</span>    <span class="keywordflow">if</span> (!atomic_compare_exchange_strong(&amp;arena-&gt;is_destroying, &amp;expected, <span class="keyword">true</span>))</div>
<div class="line"><span class="lineno">   89</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   90</span> </div>
<div class="line"><span class="lineno">   91</span><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line"><span class="lineno">   92</span>    <span class="keywordflow">if</span> (arena-&gt;use_lock)</div>
<div class="line"><span class="lineno">   93</span>    {</div>
<div class="line"><span class="lineno">   94</span>        <a class="code hl_define" href="arena__debug_8h.html#af130b4bbc0466511d1efc74412d5ef3c">ARENA_CHECK</a>(arena);</div>
<div class="line"><span class="lineno">   95</span>        <a class="code hl_define" href="arena__internal_8h.html#a5aca30bebc88f9c38377ff61521b3796">ARENA_LOCK</a>(arena);</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>        <a class="code hl_function" href="group__arena__cleanup__internal.html#ga10136f5110cb80cb4d54d4a3ff23419f">arena_free_buffer_if_owned</a>(arena);</div>
<div class="line"><span class="lineno">   98</span>        <a class="code hl_function" href="group__arena__cleanup__internal.html#ga46d3cb036c51fdf0f6f3cad6d0fcc3a6">arena_free_growth_history</a>(arena);</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>        <a class="code hl_function" href="group__arena__internal.html#ga268aa3f7256dbdf405391501fedbabd4">arena_zero_metadata</a>(arena);</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>        <a class="code hl_define" href="arena__internal_8h.html#a22d9551decc1373f55ceb93bcd8b27a3">ARENA_UNLOCK</a>(arena);</div>
<div class="line"><span class="lineno">  103</span>        arena-&gt;use_lock = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  104</span>        pthread_mutex_destroy(&amp;arena-&gt;lock);</div>
<div class="line"><span class="lineno">  105</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  106</span>    }</div>
<div class="line"><span class="lineno">  107</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>    <a class="code hl_function" href="group__arena__cleanup__internal.html#ga10136f5110cb80cb4d54d4a3ff23419f">arena_free_buffer_if_owned</a>(arena);</div>
<div class="line"><span class="lineno">  110</span>    <a class="code hl_function" href="group__arena__cleanup__internal.html#ga46d3cb036c51fdf0f6f3cad6d0fcc3a6">arena_free_growth_history</a>(arena);</div>
<div class="line"><span class="lineno">  111</span>    <a class="code hl_function" href="group__arena__internal.html#ga268aa3f7256dbdf405391501fedbabd4">arena_zero_metadata</a>(arena);</div>
<div class="line"><span class="lineno">  112</span>}</div>
<div class="ttc" id="aarena__debug_8h_html_af130b4bbc0466511d1efc74412d5ef3c"><div class="ttname"><a href="arena__debug_8h.html#af130b4bbc0466511d1efc74412d5ef3c">ARENA_CHECK</a></div><div class="ttdeci">#define ARENA_CHECK(arena)</div><div class="ttdef"><b>Definition</b> <a href="arena__debug_8h_source.html#l00419">arena_debug.h:419</a></div></div>
<div class="ttc" id="aarena__internal_8h_html_a22d9551decc1373f55ceb93bcd8b27a3"><div class="ttname"><a href="arena__internal_8h.html#a22d9551decc1373f55ceb93bcd8b27a3">ARENA_UNLOCK</a></div><div class="ttdeci">#define ARENA_UNLOCK(arena)</div><div class="ttdef"><b>Definition</b> <a href="arena__internal_8h_source.html#l00062">arena_internal.h:62</a></div></div>
<div class="ttc" id="aarena__internal_8h_html_a5aca30bebc88f9c38377ff61521b3796"><div class="ttname"><a href="arena__internal_8h.html#a5aca30bebc88f9c38377ff61521b3796">ARENA_LOCK</a></div><div class="ttdeci">#define ARENA_LOCK(arena)</div><div class="ttdoc">Acquire the mutex lock if thread safety is enabled.</div><div class="ttdef"><b>Definition</b> <a href="arena__internal_8h_source.html#l00061">arena_internal.h:61</a></div></div>
<div class="ttc" id="agroup__arena__cleanup__internal_html_ga10136f5110cb80cb4d54d4a3ff23419f"><div class="ttname"><a href="group__arena__cleanup__internal.html#ga10136f5110cb80cb4d54d4a3ff23419f">arena_free_buffer_if_owned</a></div><div class="ttdeci">static void arena_free_buffer_if_owned(t_arena *arena)</div><div class="ttdoc">Free the arena's internal buffer if the arena owns it.</div><div class="ttdef"><b>Definition</b> <a href="arena__cleanup_8c_source.html#l00186">arena_cleanup.c:186</a></div></div>
<div class="ttc" id="agroup__arena__cleanup__internal_html_ga46d3cb036c51fdf0f6f3cad6d0fcc3a6"><div class="ttname"><a href="group__arena__cleanup__internal.html#ga46d3cb036c51fdf0f6f3cad6d0fcc3a6">arena_free_growth_history</a></div><div class="ttdeci">static void arena_free_growth_history(t_arena *arena)</div><div class="ttdoc">Free the memory used to store the arena's growth history.</div><div class="ttdef"><b>Definition</b> <a href="arena__cleanup_8c_source.html#l00221">arena_cleanup.c:221</a></div></div>
<div class="ttc" id="agroup__arena__internal_html_ga268aa3f7256dbdf405391501fedbabd4"><div class="ttname"><a href="group__arena__internal.html#ga268aa3f7256dbdf405391501fedbabd4">arena_zero_metadata</a></div><div class="ttdeci">void arena_zero_metadata(t_arena *arena)</div><div class="ttdoc">Reset all metadata fields in an arena to their default values.</div><div class="ttdef"><b>Definition</b> <a href="arena__internal_8c_source.html#l00241">arena_internal.c:241</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__debug_8h_source.html#l00419">ARENA_CHECK</a>, <a class="el" href="arena__cleanup_8c_source.html#l00186">arena_free_buffer_if_owned()</a>, <a class="el" href="arena__cleanup_8c_source.html#l00221">arena_free_growth_history()</a>, <a class="el" href="arena__internal_8h_source.html#l00061">ARENA_LOCK</a>, <a class="el" href="arena__internal_8h_source.html#l00062">ARENA_UNLOCK</a>, and <a class="el" href="arena__internal_8c_source.html#l00241">arena_zero_metadata()</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__cleanup_8c_source.html#l00148">arena_delete()</a>, <a class="el" href="arena__create_8c_source.html#l00458">arena_log_and_teardown()</a>, <a class="el" href="arena__create_8c_source.html#l00361">arena_reinit_with_buffer()</a>, and <a class="el" href="arena__scratch_8c_source.html#l00302">scratch_pool_destroy()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
