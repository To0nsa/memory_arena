<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>memory_arena: Arena Resize Internals</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">memory_arena
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Arena Resize Internals<div class="ingroups"><a class="el" href="group__arena__internal.html">Internal Implementation</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Internal helpers for growing and shrinking memory buffers.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for Arena Resize Internals:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="group__arena__resize__internal.png" border="0" usemap="#agroup____arena____resize____internal" alt=""/></div>
<map name="agroup____arena____resize____internal" id="agroup____arena____resize____internal">
<area shape="rect" href="group__arena__internal.html" title="Base group for internal implementation details." alt="" coords="5,5,185,31"/>
<area shape="rect" title="Internal helpers for growing and shrinking memory buffers." alt="" coords="233,5,401,31"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga770aa7d0f606aecdb9c6858d6d04bc6e" id="r_ga770aa7d0f606aecdb9c6858d6d04bc6e"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga770aa7d0f606aecdb9c6858d6d04bc6e">arena_can_shrink</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena, size_t new_size)</td></tr>
<tr class="memdesc:ga770aa7d0f606aecdb9c6858d6d04bc6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine whether the arena is eligible for shrinking to a smaller size.  <br /></td></tr>
<tr class="separator:ga770aa7d0f606aecdb9c6858d6d04bc6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacf88b84bcca00ad988303735c64c05ab" id="r_gacf88b84bcca00ad988303735c64c05ab"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#gacf88b84bcca00ad988303735c64c05ab">arena_grow_compute_new_size</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena, size_t required_size)</td></tr>
<tr class="memdesc:gacf88b84bcca00ad988303735c64c05ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute the new size for the arena based on the growth policy.  <br /></td></tr>
<tr class="separator:gacf88b84bcca00ad988303735c64c05ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2c41abb420264a89db3a977a23d0a86c" id="r_ga2c41abb420264a89db3a977a23d0a86c"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga2c41abb420264a89db3a977a23d0a86c">arena_grow_realloc_buffer</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena, size_t new_size, size_t old_size)</td></tr>
<tr class="memdesc:ga2c41abb420264a89db3a977a23d0a86c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reallocate the arena's buffer to a new size.  <br /></td></tr>
<tr class="separator:ga2c41abb420264a89db3a977a23d0a86c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4d80b5a3e6b0f4f15be8e871759bbca5" id="r_ga4d80b5a3e6b0f4f15be8e871759bbca5"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga4d80b5a3e6b0f4f15be8e871759bbca5">arena_grow_validate</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena, size_t required_size)</td></tr>
<tr class="memdesc:ga4d80b5a3e6b0f4f15be8e871759bbca5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate whether the arena is allowed to grow for a given request.  <br /></td></tr>
<tr class="separator:ga4d80b5a3e6b0f4f15be8e871759bbca5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad63a48e38ca9296f79b12d8dee576fda" id="r_gad63a48e38ca9296f79b12d8dee576fda"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#gad63a48e38ca9296f79b12d8dee576fda">arena_record_growth</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena, size_t old_size)</td></tr>
<tr class="memdesc:gad63a48e38ca9296f79b12d8dee576fda"><td class="mdescLeft">&#160;</td><td class="mdescRight">Record the previous size of the arena in the growth history.  <br /></td></tr>
<tr class="separator:gad63a48e38ca9296f79b12d8dee576fda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga29d65ae92e063e9ae4b37940fe3c0963" id="r_ga29d65ae92e063e9ae4b37940fe3c0963"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga29d65ae92e063e9ae4b37940fe3c0963">arena_should_grow</a> (const <a class="el" href="structt__arena.html">t_arena</a> *arena)</td></tr>
<tr class="memdesc:ga29d65ae92e063e9ae4b37940fe3c0963"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the arena is allowed to grow.  <br /></td></tr>
<tr class="separator:ga29d65ae92e063e9ae4b37940fe3c0963"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae22777b5f27566fdb53247d3b34423cc" id="r_gae22777b5f27566fdb53247d3b34423cc"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#gae22777b5f27566fdb53247d3b34423cc">arena_should_maybe_shrink</a> (size_t <a class="el" href="arena__io_8h.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>, size_t size)</td></tr>
<tr class="memdesc:gae22777b5f27566fdb53247d3b34423cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decide whether the arena buffer should be shrunk based on usage ratio.  <br /></td></tr>
<tr class="separator:gae22777b5f27566fdb53247d3b34423cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga648ef2e28b422c3ea050e1a0c8d16f82" id="r_ga648ef2e28b422c3ea050e1a0c8d16f82"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga648ef2e28b422c3ea050e1a0c8d16f82">arena_shrink_apply</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena, size_t new_size)</td></tr>
<tr class="memdesc:ga648ef2e28b422c3ea050e1a0c8d16f82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the memory shrink operation to an arena's buffer.  <br /></td></tr>
<tr class="separator:ga648ef2e28b422c3ea050e1a0c8d16f82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga11682f2046cdc92c45cc6ac544a0576b" id="r_ga11682f2046cdc92c45cc6ac544a0576b"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga11682f2046cdc92c45cc6ac544a0576b">arena_shrink_target</a> (size_t <a class="el" href="arena__io_8h.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a>)</td></tr>
<tr class="memdesc:ga11682f2046cdc92c45cc6ac544a0576b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute the target buffer size for a shrink operation.  <br /></td></tr>
<tr class="separator:ga11682f2046cdc92c45cc6ac544a0576b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4857922d4fafe26b957397c9f6857f41" id="r_ga4857922d4fafe26b957397c9f6857f41"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga4857922d4fafe26b957397c9f6857f41">arena_shrink_validate</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena, size_t new_size)</td></tr>
<tr class="memdesc:ga4857922d4fafe26b957397c9f6857f41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate whether an arena can be safely shrunk to a new size.  <br /></td></tr>
<tr class="separator:ga4857922d4fafe26b957397c9f6857f41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6abbceb590e3634b0832e8ae5a34f249" id="r_ga6abbceb590e3634b0832e8ae5a34f249"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__arena__resize__internal.html#ga6abbceb590e3634b0832e8ae5a34f249">should_attempt_shrink</a> (<a class="el" href="structt__arena.html">t_arena</a> *arena)</td></tr>
<tr class="memdesc:ga6abbceb590e3634b0832e8ae5a34f249"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine whether the arena is eligible for dynamic shrinking.  <br /></td></tr>
<tr class="separator:ga6abbceb590e3634b0832e8ae5a34f249"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Internal helpers for growing and shrinking memory buffers. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga770aa7d0f606aecdb9c6858d6d04bc6e" name="ga770aa7d0f606aecdb9c6858d6d04bc6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga770aa7d0f606aecdb9c6858d6d04bc6e">&#9670;&#160;</a></span>arena_can_shrink()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool arena_can_shrink </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>new_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Determine whether the arena is eligible for shrinking to a smaller size. </p>
<p>This internal helper checks if the arena can be safely shrunk to <code>new_size</code> based on ownership, growth policy, and current memory usage.</p>
<p>Shrinking is allowed only if:</p><ul>
<li>The arena is not <code>NULL</code>.</li>
<li>The arena owns its buffer and is allowed to grow/shrink.</li>
<li>The proposed <code>new_size</code> is not smaller than the current offset.</li>
<li>The ratio of <code>new_size / current_size</code> is less than or equal to the configured threshold (<code>ARENA_MIN_SHRINK_RATIO</code>), unless it matches the offset.</li>
</ul>
<p>This function is used as a precondition check before applying memory reduction via <code><a class="el" href="arena__resize_8c.html#ac09092abf5d001bd4ff11af16fed346d">arena_shrink()</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the <code><a class="el" href="structt__arena.html" title="The main memory arena structure used for fast allocation.">t_arena</a></code> instance. </td></tr>
    <tr><td class="paramname">new_size</td><td>Proposed size for shrinking the buffer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the arena is eligible to shrink, <code>false</code> otherwise.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>If <code>new_size == arena-&gt;offset</code>, shrinking is always allowed (tight fit).</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#ac09092abf5d001bd4ff11af16fed346d">arena_shrink</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a10">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00639">639</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  640</span>{</div>
<div class="line"><span class="lineno">  641</span>    <span class="keywordflow">if</span> (!arena)</div>
<div class="line"><span class="lineno">  642</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  643</span> </div>
<div class="line"><span class="lineno">  644</span>    <span class="keywordtype">bool</span> owns = atomic_load_explicit(&amp;arena-&gt;owns_buffer, memory_order_acquire);</div>
<div class="line"><span class="lineno">  645</span>    <span class="keywordtype">bool</span> grow = atomic_load_explicit(&amp;arena-&gt;can_grow, memory_order_acquire);</div>
<div class="line"><span class="lineno">  646</span> </div>
<div class="line"><span class="lineno">  647</span>    <span class="keywordflow">if</span> (!owns || !grow)</div>
<div class="line"><span class="lineno">  648</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  649</span> </div>
<div class="line"><span class="lineno">  650</span>    <span class="keywordflow">if</span> (new_size &lt; arena-&gt;offset)</div>
<div class="line"><span class="lineno">  651</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  652</span> </div>
<div class="line"><span class="lineno">  653</span>    <span class="keywordflow">if</span> (new_size == arena-&gt;offset)</div>
<div class="line"><span class="lineno">  654</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  655</span> </div>
<div class="line"><span class="lineno">  656</span>    <span class="keywordtype">double</span> shrink_ratio = (double) new_size / (<span class="keywordtype">double</span>) arena-&gt;size;</div>
<div class="line"><span class="lineno">  657</span>    <span class="keywordflow">return</span> shrink_ratio &lt;= <a class="code hl_define" href="arena__config_8h.html#af980329701af53ca4e64074d249a43c3">ARENA_MIN_SHRINK_RATIO</a>;</div>
<div class="line"><span class="lineno">  658</span>}</div>
<div class="ttc" id="aarena__config_8h_html_af980329701af53ca4e64074d249a43c3"><div class="ttname"><a href="arena__config_8h.html#af980329701af53ca4e64074d249a43c3">ARENA_MIN_SHRINK_RATIO</a></div><div class="ttdeci">#define ARENA_MIN_SHRINK_RATIO</div><div class="ttdoc">Shrink threshold: offset &lt; ratio * size.</div><div class="ttdef"><b>Definition</b> <a href="arena__config_8h_source.html#l00016">arena_config.h:16</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__config_8h_source.html#l00016">ARENA_MIN_SHRINK_RATIO</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00680">arena_shrink_validate()</a>.</p>

</div>
</div>
<a id="gacf88b84bcca00ad988303735c64c05ab" name="gacf88b84bcca00ad988303735c64c05ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacf88b84bcca00ad988303735c64c05ab">&#9670;&#160;</a></span>arena_grow_compute_new_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t arena_grow_compute_new_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>required_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Compute the new size for the arena based on the growth policy. </p>
<p>This internal function calculates an appropriate new buffer size that satisfies the <code>required_size</code> request, starting from the current size and offset. It uses the user-defined growth callback if set, or defaults to <code>default_grow_cb</code> otherwise.</p>
<p>The result is validated to ensure it is:</p><ul>
<li>Large enough to satisfy the requested offset + size.</li>
<li>Not exceeding <code>SIZE_MAX</code>.</li>
</ul>
<p>If the computed size is invalid (too small or overflowing), the function returns <code>0</code> to indicate failure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the arena requesting growth. </td></tr>
    <tr><td class="paramname">required_size</td><td>The number of additional bytes needed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The computed new size in bytes, or <code>0</code> if the value is invalid.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a223081ace38b33a46cc1ed0eaadf867f">arena_grow</a> </dd>
<dd>
<a class="el" href="group__arena__resize__internal.html#ga4d80b5a3e6b0f4f15be8e871759bbca5" title="Validate whether the arena is allowed to grow for a given request.">arena_grow_validate</a> </dd>
<dd>
<a class="el" href="arena_8h.html#abb1be1f36e6a52d5673bdd0e98cfb7f1">arena_grow_callback</a> </dd>
<dd>
<a class="el" href="group__arena__internal.html#ga627d4fdc46e225dccde0388ae40d04de" title="Default growth strategy for arenas that support dynamic resizing.">default_grow_cb</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a8">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00552">552</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  553</span>{</div>
<div class="line"><span class="lineno">  554</span>    <a class="code hl_typedef" href="arena_8h.html#abb1be1f36e6a52d5673bdd0e98cfb7f1">arena_grow_callback</a> cb        = arena-&gt;grow_cb ? arena-&gt;grow_cb : <a class="code hl_function" href="group__arena__internal.html#ga627d4fdc46e225dccde0388ae40d04de">default_grow_cb</a>;</div>
<div class="line"><span class="lineno">  555</span>    <span class="keywordtype">size_t</span>              requested = arena-&gt;offset + required_size;</div>
<div class="line"><span class="lineno">  556</span>    <span class="keywordtype">size_t</span>              new_size  = cb(arena-&gt;size, required_size);</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>    <span class="keywordflow">if</span> (new_size &lt; requested)</div>
<div class="line"><span class="lineno">  559</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  560</span>    <span class="keywordflow">if</span> (new_size &gt; SIZE_MAX)</div>
<div class="line"><span class="lineno">  561</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  562</span> </div>
<div class="line"><span class="lineno">  563</span>    <span class="keywordflow">return</span> new_size;</div>
<div class="line"><span class="lineno">  564</span>}</div>
<div class="ttc" id="aarena_8h_html_abb1be1f36e6a52d5673bdd0e98cfb7f1"><div class="ttname"><a href="arena_8h.html#abb1be1f36e6a52d5673bdd0e98cfb7f1">arena_grow_callback</a></div><div class="ttdeci">size_t(* arena_grow_callback)(size_t current_size, size_t requested_size)</div><div class="ttdef"><b>Definition</b> <a href="arena_8h_source.html#l00079">arena.h:79</a></div></div>
<div class="ttc" id="agroup__arena__internal_html_ga627d4fdc46e225dccde0388ae40d04de"><div class="ttname"><a href="group__arena__internal.html#ga627d4fdc46e225dccde0388ae40d04de">default_grow_cb</a></div><div class="ttdeci">size_t default_grow_cb(size_t current_size, size_t requested_size)</div><div class="ttdoc">Default growth strategy for arenas that support dynamic resizing.</div><div class="ttdef"><b>Definition</b> <a href="arena__internal_8c_source.html#l00078">arena_internal.c:78</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__internal_8c_source.html#l00078">default_grow_cb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00142">arena_grow()</a>.</p>

</div>
</div>
<a id="ga2c41abb420264a89db3a977a23d0a86c" name="ga2c41abb420264a89db3a977a23d0a86c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2c41abb420264a89db3a977a23d0a86c">&#9670;&#160;</a></span>arena_grow_realloc_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool arena_grow_realloc_buffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>new_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>old_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Reallocate the arena's buffer to a new size. </p>
<p>This internal function performs the actual <code>realloc()</code> of the arena's buffer during a grow operation. It attempts to allocate a new buffer of <code>new_size</code> bytes, and if successful:</p><ul>
<li>Updates the buffer pointer and size.</li>
<li>Increments the reallocation counter.</li>
<li>Records the previous size in the arena's growth history.</li>
<li>Emits a debug log message indicating the resize.</li>
</ul>
<p>If reallocation fails, an error is reported and <code>false</code> is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the arena being resized. </td></tr>
    <tr><td class="paramname">new_size</td><td>Target buffer size after reallocation (in bytes). </td></tr>
    <tr><td class="paramname">old_size</td><td>Original size of the buffer before reallocation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if reallocation succeeded, <code>false</code> otherwise.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a223081ace38b33a46cc1ed0eaadf867f">arena_grow</a> </dd>
<dd>
<a class="el" href="group__arena__resize__internal.html#gad63a48e38ca9296f79b12d8dee576fda" title="Record the previous size of the arena in the growth history.">arena_record_growth</a> </dd>
<dd>
realloc </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a9">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00593">593</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  594</span>{</div>
<div class="line"><span class="lineno">  595</span>    <span class="keywordtype">void</span>* new_buf = realloc(arena-&gt;buffer, new_size);</div>
<div class="line"><span class="lineno">  596</span>    <span class="keywordflow">if</span> (!new_buf)</div>
<div class="line"><span class="lineno">  597</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(arena, <span class="stringliteral">&quot;arena_grow failed: realloc failed&quot;</span>), <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  598</span> </div>
<div class="line"><span class="lineno">  599</span>    arena-&gt;buffer = (uint8_t*) new_buf;</div>
<div class="line"><span class="lineno">  600</span>    arena-&gt;size   = new_size;</div>
<div class="line"><span class="lineno">  601</span>    arena-&gt;stats.reallocations++;</div>
<div class="line"><span class="lineno">  602</span> </div>
<div class="line"><span class="lineno">  603</span>    <a class="code hl_function" href="group__arena__resize__internal.html#gad63a48e38ca9296f79b12d8dee576fda">arena_record_growth</a>(arena, old_size);</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>    <a class="code hl_define" href="arena__debug_8h.html#abf0e7a681c28a08824cb678ec3f9a6c6">ALOG</a>(<span class="stringliteral">&quot;[arena_grow] Arena %p grown from %zu to %zu bytes\n&quot;</span>, (<span class="keywordtype">void</span>*) arena, old_size, new_size);</div>
<div class="line"><span class="lineno">  606</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  607</span>}</div>
<div class="ttc" id="aarena__debug_8h_html_abf0e7a681c28a08824cb678ec3f9a6c6"><div class="ttname"><a href="arena__debug_8h.html#abf0e7a681c28a08824cb678ec3f9a6c6">ALOG</a></div><div class="ttdeci">#define ALOG(...)</div><div class="ttdoc">Debug logging macro (enabled only if ARENA_DEBUG_LOG is set).</div><div class="ttdef"><b>Definition</b> <a href="arena__debug_8h_source.html#l00434">arena_debug.h:434</a></div></div>
<div class="ttc" id="aarena__debug_8h_html_ad19e051bc49dc6b6dcda0f31561e222d"><div class="ttname"><a href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a></div><div class="ttdeci">void arena_report_error(t_arena *arena, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="arena__debug_8c_source.html#l00253">arena_debug.c:253</a></div></div>
<div class="ttc" id="agroup__arena__resize__internal_html_gad63a48e38ca9296f79b12d8dee576fda"><div class="ttname"><a href="group__arena__resize__internal.html#gad63a48e38ca9296f79b12d8dee576fda">arena_record_growth</a></div><div class="ttdeci">static void arena_record_growth(t_arena *arena, size_t old_size)</div><div class="ttdoc">Record the previous size of the arena in the growth history.</div><div class="ttdef"><b>Definition</b> <a href="arena__resize_8c_source.html#l00472">arena_resize.c:472</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__debug_8h_source.html#l00434">ALOG</a>, <a class="el" href="arena__resize_8c_source.html#l00472">arena_record_growth()</a>, and <a class="el" href="arena__debug_8c_source.html#l00253">arena_report_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00142">arena_grow()</a>.</p>

</div>
</div>
<a id="ga4d80b5a3e6b0f4f15be8e871759bbca5" name="ga4d80b5a3e6b0f4f15be8e871759bbca5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4d80b5a3e6b0f4f15be8e871759bbca5">&#9670;&#160;</a></span>arena_grow_validate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool arena_grow_validate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>required_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Validate whether the arena is allowed to grow for a given request. </p>
<p>This internal helper checks if the arena meets the conditions necessary to perform a growth operation. It verifies:</p>
<ul>
<li>That the arena is marked as growable (<code>can_grow == true</code>).</li>
<li>That the arena owns its buffer (<code>owns_buffer == true</code>).</li>
<li>That the requested growth does not overflow <code>size_t</code> when added to the current offset.</li>
</ul>
<p>If any condition fails, an error is reported using <code><a class="el" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error()</a></code> and the function returns <code>false</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the arena to validate. </td></tr>
    <tr><td class="paramname">required_size</td><td>The number of additional bytes needed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the arena is eligible for growth, <code>false</code> otherwise.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function is called from within a section where the arena is already locked for thread safety.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a223081ace38b33a46cc1ed0eaadf867f">arena_grow</a> </dd>
<dd>
<a class="el" href="group__arena__resize__internal.html#ga29d65ae92e063e9ae4b37940fe3c0963" title="Check whether the arena is allowed to grow.">arena_should_grow</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a7">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00512">512</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  513</span>{</div>
<div class="line"><span class="lineno">  514</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__resize__internal.html#ga29d65ae92e063e9ae4b37940fe3c0963">arena_should_grow</a>(arena))</div>
<div class="line"><span class="lineno">  515</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(arena, <span class="stringliteral">&quot;arena_grow failed: growth not allowed&quot;</span>), <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>    <span class="keywordflow">if</span> (required_size &gt; SIZE_MAX - arena-&gt;offset)</div>
<div class="line"><span class="lineno">  518</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(arena, <span class="stringliteral">&quot;arena_grow failed: size overflow&quot;</span>), <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  519</span> </div>
<div class="line"><span class="lineno">  520</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  521</span>}</div>
<div class="ttc" id="agroup__arena__resize__internal_html_ga29d65ae92e063e9ae4b37940fe3c0963"><div class="ttname"><a href="group__arena__resize__internal.html#ga29d65ae92e063e9ae4b37940fe3c0963">arena_should_grow</a></div><div class="ttdeci">static bool arena_should_grow(const t_arena *arena)</div><div class="ttdoc">Check whether the arena is allowed to grow.</div><div class="ttdef"><b>Definition</b> <a href="arena__resize_8c_source.html#l00440">arena_resize.c:440</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__debug_8c_source.html#l00253">arena_report_error()</a>, and <a class="el" href="arena__resize_8c_source.html#l00440">arena_should_grow()</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00142">arena_grow()</a>.</p>

</div>
</div>
<a id="gad63a48e38ca9296f79b12d8dee576fda" name="gad63a48e38ca9296f79b12d8dee576fda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad63a48e38ca9296f79b12d8dee576fda">&#9670;&#160;</a></span>arena_record_growth()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void arena_record_growth </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>old_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Record the previous size of the arena in the growth history. </p>
<p>This internal helper appends the <code>old_size</code> of the arena to its <code>growth_history</code> array. This array keeps track of all prior sizes before each successful call to <code><a class="el" href="arena__resize_8c.html#a223081ace38b33a46cc1ed0eaadf867f">arena_grow()</a></code>, allowing for optional introspection, debugging, or visualization of growth patterns.</p>
<p>It reallocates the history buffer with enough room for the new entry. If <code>realloc</code> fails, the history is not updated, but the function fails silently to avoid interrupting allocation logic.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the arena whose growth is being tracked. </td></tr>
    <tr><td class="paramname">old_size</td><td>The size of the arena before a successful growth.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function is called from within a section that already holds the arena lock.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a223081ace38b33a46cc1ed0eaadf867f">arena_grow</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a6">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00472">472</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  473</span>{</div>
<div class="line"><span class="lineno">  474</span>    <span class="keywordtype">size_t</span>* temp = realloc(arena-&gt;stats.growth_history, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>) * (arena-&gt;stats.growth_history_count + 1));</div>
<div class="line"><span class="lineno">  475</span>    <span class="keywordflow">if</span> (temp)</div>
<div class="line"><span class="lineno">  476</span>    {</div>
<div class="line"><span class="lineno">  477</span>        arena-&gt;stats.growth_history                                      = temp;</div>
<div class="line"><span class="lineno">  478</span>        arena-&gt;stats.growth_history[arena-&gt;stats.growth_history_count++] = old_size;</div>
<div class="line"><span class="lineno">  479</span>    }</div>
<div class="line"><span class="lineno">  480</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00593">arena_grow_realloc_buffer()</a>.</p>

</div>
</div>
<a id="ga29d65ae92e063e9ae4b37940fe3c0963" name="ga29d65ae92e063e9ae4b37940fe3c0963"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga29d65ae92e063e9ae4b37940fe3c0963">&#9670;&#160;</a></span>arena_should_grow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool arena_should_grow </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Check whether the arena is allowed to grow. </p>
<p>This internal helper verifies if the arena is configured to support dynamic growth. It performs the following checks:</p><ul>
<li>The arena must own its memory buffer (<code>owns_buffer == true</code>).</li>
<li>The arena must have growth enabled (<code>can_grow == true</code>).</li>
</ul>
<p>If both conditions are met, the arena can attempt to grow when additional memory is needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the <code><a class="el" href="structt__arena.html" title="The main memory arena structure used for fast allocation.">t_arena</a></code> structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the arena can grow, <code>false</code> otherwise.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function assumes <code>arena</code> is non-NULL. It is called by a function that validates the pointer before calling.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a223081ace38b33a46cc1ed0eaadf867f">arena_grow</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a5">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00440">440</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  441</span>{</div>
<div class="line"><span class="lineno">  442</span>    <span class="keywordtype">bool</span> owns = atomic_load_explicit(&amp;arena-&gt;owns_buffer, memory_order_acquire);</div>
<div class="line"><span class="lineno">  443</span>    <span class="keywordtype">bool</span> grow = atomic_load_explicit(&amp;arena-&gt;can_grow, memory_order_acquire);</div>
<div class="line"><span class="lineno">  444</span>    <span class="keywordflow">return</span> owns &amp;&amp; grow;</div>
<div class="line"><span class="lineno">  445</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00512">arena_grow_validate()</a>.</p>

</div>
</div>
<a id="gae22777b5f27566fdb53247d3b34423cc" name="gae22777b5f27566fdb53247d3b34423cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae22777b5f27566fdb53247d3b34423cc">&#9670;&#160;</a></span>arena_should_maybe_shrink()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool arena_should_maybe_shrink </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>used</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Decide whether the arena buffer should be shrunk based on usage ratio. </p>
<p>This helper compares the ratio of used bytes to total allocated buffer size. If the usage ratio falls below <code>ARENA_MIN_SHRINK_RATIO</code>, the arena is considered underutilized and may be eligible for shrinking.</p>
<p>Typical usage scenarios include:</p><ul>
<li>Periodic memory trimming in long-running programs.</li>
<li>Adaptive memory management after large but short-lived allocations.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">used</td><td>Number of bytes currently used in the arena. </td></tr>
    <tr><td class="paramname">size</td><td>Total capacity of the arena buffer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the usage is low enough to consider shrinking, <code>false</code> otherwise.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>If <code>size</code> is 0, this function returns <code>false</code> to avoid division-by-zero.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a43195b93eadf7cbd1155836c887ac54d">arena_might_shrink</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a14">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00787">787</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  788</span>{</div>
<div class="line"><span class="lineno">  789</span>    <span class="keywordflow">if</span> (size == 0)</div>
<div class="line"><span class="lineno">  790</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  791</span> </div>
<div class="line"><span class="lineno">  792</span>    <span class="keywordtype">double</span> ratio = (double) <a class="code hl_variable" href="arena__io_8h.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a> / (<span class="keywordtype">double</span>) size;</div>
<div class="line"><span class="lineno">  793</span>    <span class="keywordflow">return</span> ratio &lt; <a class="code hl_define" href="arena__config_8h.html#af980329701af53ca4e64074d249a43c3">ARENA_MIN_SHRINK_RATIO</a>;</div>
<div class="line"><span class="lineno">  794</span>}</div>
<div class="ttc" id="aarena__io_8h_html_ae8cc011bf3ee2d3c19743095ffc0f7a5"><div class="ttname"><a href="arena__io_8h.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a></div><div class="ttdeci">size_t used</div><div class="ttdoc">Number of bytes used in the arena buffer.</div><div class="ttdef"><b>Definition</b> <a href="arena__io_8h_source.html#l00002">arena_io.h:2</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__config_8h_source.html#l00016">ARENA_MIN_SHRINK_RATIO</a>, and <a class="el" href="arena__io_8h_source.html#l00002">used</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00384">arena_might_shrink()</a>.</p>

</div>
</div>
<a id="ga648ef2e28b422c3ea050e1a0c8d16f82" name="ga648ef2e28b422c3ea050e1a0c8d16f82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga648ef2e28b422c3ea050e1a0c8d16f82">&#9670;&#160;</a></span>arena_shrink_apply()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool arena_shrink_apply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>new_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Apply the memory shrink operation to an arena's buffer. </p>
<p>This internal function performs the actual memory reallocation to reduce the arena's backing buffer to <code>new_size</code> bytes.</p>
<p>On success:</p><ul>
<li>The arena's <code>buffer</code> pointer and <code>size</code> field are updated.</li>
<li>The <code>shrinks</code> counter in arena statistics is incremented.</li>
<li>A debug log message is printed.</li>
</ul>
<p>If <code>realloc()</code> fails, the arena remains unchanged and the function returns <code>false</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the arena to shrink. </td></tr>
    <tr><td class="paramname">new_size</td><td>New desired size of the arena buffer (in bytes).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> on successful shrink, <code>false</code> on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function is only called after validating the shrink operation.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__arena__resize__internal.html#ga770aa7d0f606aecdb9c6858d6d04bc6e" title="Determine whether the arena is eligible for shrinking to a smaller size.">arena_can_shrink</a> </dd>
<dd>
<a class="el" href="arena__resize_8c.html#ac09092abf5d001bd4ff11af16fed346d">arena_shrink</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a12">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00719">719</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  720</span>{</div>
<div class="line"><span class="lineno">  721</span>    <span class="keywordtype">void</span>* new_buf = realloc(arena-&gt;buffer, new_size);</div>
<div class="line"><span class="lineno">  722</span>    <span class="keywordflow">if</span> (!new_buf)</div>
<div class="line"><span class="lineno">  723</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  724</span> </div>
<div class="line"><span class="lineno">  725</span>    arena-&gt;buffer = (uint8_t*) new_buf;</div>
<div class="line"><span class="lineno">  726</span>    arena-&gt;size   = new_size;</div>
<div class="line"><span class="lineno">  727</span>    arena-&gt;stats.shrinks++;</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>    <a class="code hl_define" href="arena__debug_8h.html#abf0e7a681c28a08824cb678ec3f9a6c6">ALOG</a>(<span class="stringliteral">&quot;[arena_shrink] Arena %p shrunk to %zu bytes\n&quot;</span>, (<span class="keywordtype">void</span>*) arena, new_size);</div>
<div class="line"><span class="lineno">  730</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  731</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__debug_8h_source.html#l00434">ALOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00267">arena_shrink()</a>.</p>

</div>
</div>
<a id="ga11682f2046cdc92c45cc6ac544a0576b" name="ga11682f2046cdc92c45cc6ac544a0576b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga11682f2046cdc92c45cc6ac544a0576b">&#9670;&#160;</a></span>arena_shrink_target()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t arena_shrink_target </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>used</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Compute the target buffer size for a shrink operation. </p>
<p>This helper calculates a reasonable new size for the arena buffer when shrinking is considered. It adds a small safety margin (<code>ARENA_SHRINK_PADDING</code>) to the current usage (<code>used</code>) to avoid immediate re-growth if a small allocation occurs after shrinking.</p>
<p>The padding ensures that the buffer remains slightly larger than strictly needed, providing better performance and avoiding fragmentation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">used</td><td>Number of bytes currently used in the arena.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Suggested new size for the buffer after shrinking.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a43195b93eadf7cbd1155836c887ac54d">arena_might_shrink</a> </dd>
<dd>
<a class="el" href="arena__resize_8c.html#ac09092abf5d001bd4ff11af16fed346d">arena_shrink</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a16">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00818">818</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  819</span>{</div>
<div class="line"><span class="lineno">  820</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="arena__io_8h.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">used</a> + <a class="code hl_define" href="arena__config_8h.html#aced1b6e804e7cc6cdcc93894dcee11ee">ARENA_SHRINK_PADDING</a>;</div>
<div class="line"><span class="lineno">  821</span>}</div>
<div class="ttc" id="aarena__config_8h_html_aced1b6e804e7cc6cdcc93894dcee11ee"><div class="ttname"><a href="arena__config_8h.html#aced1b6e804e7cc6cdcc93894dcee11ee">ARENA_SHRINK_PADDING</a></div><div class="ttdeci">#define ARENA_SHRINK_PADDING</div><div class="ttdoc">Extra padding when computing shrink sizes.</div><div class="ttdef"><b>Definition</b> <a href="arena__config_8h_source.html#l00021">arena_config.h:21</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__config_8h_source.html#l00021">ARENA_SHRINK_PADDING</a>, and <a class="el" href="arena__io_8h_source.html#l00002">used</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00384">arena_might_shrink()</a>.</p>

</div>
</div>
<a id="ga4857922d4fafe26b957397c9f6857f41" name="ga4857922d4fafe26b957397c9f6857f41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4857922d4fafe26b957397c9f6857f41">&#9670;&#160;</a></span>arena_shrink_validate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool arena_shrink_validate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>new_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Validate whether an arena can be safely shrunk to a new size. </p>
<p>This internal helper wraps the logic of <code><a class="el" href="group__arena__resize__internal.html#ga770aa7d0f606aecdb9c6858d6d04bc6e" title="Determine whether the arena is eligible for shrinking to a smaller size.">arena_can_shrink()</a></code> with an initial null-check on the arena itself. It is used to guard shrink operations such as <code><a class="el" href="arena__resize_8c.html#ac09092abf5d001bd4ff11af16fed346d">arena_shrink()</a></code> and <code><a class="el" href="arena__resize_8c.html#a43195b93eadf7cbd1155836c887ac54d">arena_might_shrink()</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the arena to validate. </td></tr>
    <tr><td class="paramname">new_size</td><td>Proposed size to shrink the arena to (in bytes).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the arena is not <code>NULL</code> and is allowed to shrink, <code>false</code> otherwise.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__arena__resize__internal.html#ga770aa7d0f606aecdb9c6858d6d04bc6e" title="Determine whether the arena is eligible for shrinking to a smaller size.">arena_can_shrink</a> </dd>
<dd>
<a class="el" href="arena__resize_8c.html#ac09092abf5d001bd4ff11af16fed346d">arena_shrink</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a11">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00680">680</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  681</span>{</div>
<div class="line"><span class="lineno">  682</span>    <span class="keywordflow">if</span> (!arena)</div>
<div class="line"><span class="lineno">  683</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__resize__internal.html#ga770aa7d0f606aecdb9c6858d6d04bc6e">arena_can_shrink</a>(arena, new_size))</div>
<div class="line"><span class="lineno">  686</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  687</span> </div>
<div class="line"><span class="lineno">  688</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  689</span>}</div>
<div class="ttc" id="agroup__arena__resize__internal_html_ga770aa7d0f606aecdb9c6858d6d04bc6e"><div class="ttname"><a href="group__arena__resize__internal.html#ga770aa7d0f606aecdb9c6858d6d04bc6e">arena_can_shrink</a></div><div class="ttdeci">static bool arena_can_shrink(t_arena *arena, size_t new_size)</div><div class="ttdoc">Determine whether the arena is eligible for shrinking to a smaller size.</div><div class="ttdef"><b>Definition</b> <a href="arena__resize_8c_source.html#l00639">arena_resize.c:639</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="arena__resize_8c_source.html#l00639">arena_can_shrink()</a>.</p>

<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00267">arena_shrink()</a>.</p>

</div>
</div>
<a id="ga6abbceb590e3634b0832e8ae5a34f249" name="ga6abbceb590e3634b0832e8ae5a34f249"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6abbceb590e3634b0832e8ae5a34f249">&#9670;&#160;</a></span>should_attempt_shrink()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool should_attempt_shrink </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structt__arena.html">t_arena</a> *&#160;</td>
          <td class="paramname"><em>arena</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="arena__resize_8c.html">arena_resize.c</a>&gt;</code></p>

<p>Determine whether the arena is eligible for dynamic shrinking. </p>
<p>This helper checks if the arena is in a state that allows shrinking. Shrinking is only permitted if:</p><ul>
<li>The <code>arena</code> pointer is not <code>NULL</code>.</li>
<li>The arena has dynamic growth enabled (<code>can_grow</code> is <code>true</code>).</li>
</ul>
<p>This function is typically used before triggering automatic shrinking logic, such as in <code><a class="el" href="arena__resize_8c.html#a43195b93eadf7cbd1155836c887ac54d">arena_might_shrink()</a></code>, to avoid unnecessary operations.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arena</td><td>Pointer to the arena to check.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if the arena can potentially be shrunk, <code>false</code> otherwise.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__resize_8c.html#a43195b93eadf7cbd1155836c887ac54d">arena_might_shrink</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="_2home_2toonsa_2myProjects_2memoryArena_2srcs_2core_2arena_resize_8c-example.html#a13">/home/toonsa/myProjects/memoryArena/srcs/core/arena_resize.c</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="arena__resize_8c_source.html#l00754">754</a> of file <a class="el" href="arena__resize_8c_source.html">arena_resize.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  755</span>{</div>
<div class="line"><span class="lineno">  756</span>    <span class="keywordflow">if</span> (!arena)</div>
<div class="line"><span class="lineno">  757</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  758</span> </div>
<div class="line"><span class="lineno">  759</span>    <span class="keywordflow">return</span> atomic_load_explicit(&amp;arena-&gt;can_grow, memory_order_acquire);</div>
<div class="line"><span class="lineno">  760</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="arena__resize_8c_source.html#l00384">arena_might_shrink()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
