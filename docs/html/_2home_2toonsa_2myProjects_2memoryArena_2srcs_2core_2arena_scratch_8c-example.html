<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>memory_arena: /home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">memory_arena
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">/home/toonsa/myProjects/memoryArena/srcs/core/arena_scratch.c</div></div>
</div><!--header-->
<div class="contents">
<p>Example usage of the scratch arena pool API for temporary memory buffers.</p>
<p>Example usage of the scratch arena pool API for temporary memory buffers.This example demonstrates how to use <code><a class="el" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a" title="Acquire a temporary scratch arena from the pool.">scratch_acquire()</a></code> and <code><a class="el" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660" title="Release a scratch arena back to the pool for reuse.">scratch_release()</a></code> to manage fast, disposable memory during the handling of short-lived tasks such as formatting temporary strings or processing per-frame data.</p>
<p>The scratch pool is initialized once and reused across multiple function calls. Each scratch slot provides its own growable arena that is reset between uses, making it ideal for avoiding heap fragmentation and unnecessary allocations.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="arena__scratch_8h.html">arena_scratch.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_NAME_LEN 64</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Simulate a temporary task using scratch memory</span></div>
<div class="line"><span class="keywordtype">void</span> process_user_request(<a id="_a0" name="_a0"></a><a class="code hl_struct" href="group__arena__scratch.html#structs__scratch__arena__pool">t_scratch_arena_pool</a>* scratch_pool, <span class="keyword">const</span> <span class="keywordtype">char</span>* username)</div>
<div class="line">{</div>
<div class="line">    <a id="_a1" name="_a1"></a><a class="code hl_struct" href="structt__arena.html">t_arena</a>* scratch = <a id="a2" name="a2"></a><a class="code hl_function" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a">scratch_acquire</a>(scratch_pool);</div>
<div class="line">    <span class="keywordflow">if</span> (!scratch)</div>
<div class="line">    {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to acquire scratch arena\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Allocate temporary buffer inside scratch arena</span></div>
<div class="line">    <span class="keywordtype">char</span>* message = (<span class="keywordtype">char</span>*) <a id="a3" name="a3"></a><a class="code hl_function" href="arena_8h.html#a1def00c6156e8df19f0a1af7cd6f26dd">arena_alloc</a>(scratch, 256);</div>
<div class="line">    <span class="keywordflow">if</span> (!message)</div>
<div class="line">    {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to allocate message buffer\n&quot;</span>);</div>
<div class="line">        <a id="a4" name="a4"></a><a class="code hl_function" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660">scratch_release</a>(scratch_pool, scratch);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    snprintf(message, 256, <span class="stringliteral">&quot;Welcome back, %s!&quot;</span>, username);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s\n&quot;</span>, message);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Release scratch slot for reuse</span></div>
<div class="line">    <a class="code hl_function" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660">scratch_release</a>(scratch_pool, scratch);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="group__arena__scratch.html#structs__scratch__arena__pool">t_scratch_arena_pool</a> scratch_pool;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a thread-safe pool with 8 slots of 4KB each</span></div>
<div class="line">    <span class="keywordflow">if</span> (!<a id="a5" name="a5"></a><a class="code hl_function" href="group__arena__scratch.html#gaacf85b896eca809714ae5b80bce9b998">scratch_pool_init</a>(&amp;scratch_pool, 4096, <span class="keyword">true</span>))</div>
<div class="line">    {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to initialize scratch pool\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Simulate multiple requests</span></div>
<div class="line">    process_user_request(&amp;scratch_pool, <span class="stringliteral">&quot;Toonsa&quot;</span>);</div>
<div class="line">    process_user_request(&amp;scratch_pool, <span class="stringliteral">&quot;Linus Torvalds&quot;</span>);</div>
<div class="line">    process_user_request(&amp;scratch_pool, <span class="stringliteral">&quot;ArenaUser&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a id="a6" name="a6"></a><a class="code hl_function" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c">scratch_pool_destroy</a>(&amp;scratch_pool);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aarena_8h_html_a1def00c6156e8df19f0a1af7cd6f26dd"><div class="ttname"><a href="arena_8h.html#a1def00c6156e8df19f0a1af7cd6f26dd">arena_alloc</a></div><div class="ttdeci">void * arena_alloc(t_arena *arena, size_t size)</div><div class="ttdef"><b>Definition</b> <a href="arena__alloc_8c_source.html#l00112">arena_alloc.c:112</a></div></div>
<div class="ttc" id="aarena__scratch_8h_html"><div class="ttname"><a href="arena__scratch_8h.html">arena_scratch.h</a></div><div class="ttdoc">Scratch arena pool system for fast, reusable temporary allocations.</div></div>
<div class="ttc" id="agroup__arena__scratch_html_ga11827715e3ea2c02b2ddd7313bf7551c"><div class="ttname"><a href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c">scratch_pool_destroy</a></div><div class="ttdeci">void scratch_pool_destroy(t_scratch_arena_pool *pool)</div><div class="ttdoc">Destroy all arenas in a scratch pool and reset its metadata.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8c_source.html#l00302">arena_scratch.c:302</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_ga244f078e83929f392e441ca375c2230a"><div class="ttname"><a href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a">scratch_acquire</a></div><div class="ttdeci">t_arena * scratch_acquire(t_scratch_arena_pool *pool)</div><div class="ttdoc">Acquire a temporary scratch arena from the pool.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8c_source.html#l00350">arena_scratch.c:350</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_gaacf85b896eca809714ae5b80bce9b998"><div class="ttname"><a href="group__arena__scratch.html#gaacf85b896eca809714ae5b80bce9b998">scratch_pool_init</a></div><div class="ttdeci">bool scratch_pool_init(t_scratch_arena_pool *pool, size_t slot_size, bool thread_safe)</div><div class="ttdoc">Initialize a scratch arena pool with pre-allocated slots.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8c_source.html#l00249">arena_scratch.c:249</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_gade0c7f0a1b88c47211db8f2c9f3f3660"><div class="ttname"><a href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660">scratch_release</a></div><div class="ttdeci">void scratch_release(t_scratch_arena_pool *pool, t_arena *arena)</div><div class="ttdoc">Release a scratch arena back to the pool for reuse.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8c_source.html#l00398">arena_scratch.c:398</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_structs__scratch__arena__pool"><div class="ttname"><a href="group__arena__scratch.html#structs__scratch__arena__pool">s_scratch_arena_pool</a></div><div class="ttdoc">Scratch arena pool structure holding multiple reusable memory arenas.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00089">arena_scratch.h:90</a></div></div>
<div class="ttc" id="astructt__arena_html"><div class="ttname"><a href="structt__arena.html">t_arena</a></div><div class="ttdoc">The main memory arena structure used for fast allocation.</div></div>
</div><!-- fragment --><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="arena__scratch_8h.html">arena_scratch.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * INTERNAL HELPER DECLARATION</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> <a id="a7" name="a7"></a><a class="code hl_function" href="group__arena__scratch__internal.html#gae37e23cb6b3d190982157208a850d840">scratch_slot_init</a>(<a id="_a8" name="_a8"></a><a class="code hl_struct" href="group__arena__scratch__internal.html#structs__scratch__slot">t_scratch_slot</a>* slot, <span class="keywordtype">size_t</span> slot_size, <span class="keywordtype">int</span> index);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * PUBLIC API</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code hl_function" href="group__arena__scratch.html#gaacf85b896eca809714ae5b80bce9b998">scratch_pool_init</a>(<a class="code hl_struct" href="group__arena__scratch.html#structs__scratch__arena__pool">t_scratch_arena_pool</a>* pool, <span class="keywordtype">size_t</span> slot_size, <span class="keywordtype">bool</span> thread_safe)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!pool || slot_size == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a id="a9" name="a9"></a><a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_pool_init failed: invalid arguments&quot;</span>), <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">    memset(pool, 0, <span class="keyword">sizeof</span>(*pool));</div>
<div class="line">    pool-&gt;<a id="a10" name="a10"></a><a class="code hl_variable" href="group__arena__scratch.html#a64c052156b441b7adf46af210b8fcf95">slot_size</a>   = slot_size;</div>
<div class="line">    pool-&gt;<a id="a11" name="a11"></a><a class="code hl_variable" href="group__arena__scratch.html#af715e967b0a60c4da8500be7d3ac7ca3">thread_safe</a> = thread_safe;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line">    <span class="keywordflow">if</span> (thread_safe)</div>
<div class="line">        pthread_mutex_init(&amp;pool-&gt;<a id="a12" name="a12"></a><a class="code hl_variable" href="group__arena__scratch.html#a6504b8d51c2b438853b18f89cb70d9a0">lock</a>, NULL);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a id="a13" name="a13"></a><a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__scratch__internal.html#gae37e23cb6b3d190982157208a850d840">scratch_slot_init</a>(&amp;pool-&gt;<a id="a14" name="a14"></a><a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i], slot_size, i))</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_function" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c">scratch_pool_destroy</a>(pool);</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="group__arena__scratch.html#ga11827715e3ea2c02b2ddd7313bf7551c">scratch_pool_destroy</a>(<a class="code hl_struct" href="group__arena__scratch.html#structs__scratch__arena__pool">t_scratch_arena_pool</a>* pool)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!pool)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line">        <a id="a15" name="a15"></a><a class="code hl_function" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a>(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a id="a16" name="a16"></a><a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line">    <span class="keywordflow">if</span> (pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#af715e967b0a60c4da8500be7d3ac7ca3">thread_safe</a>)</div>
<div class="line">        pthread_mutex_destroy(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#a6504b8d51c2b438853b18f89cb70d9a0">lock</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    memset(pool, 0, <span class="keyword">sizeof</span>(*pool));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structt__arena.html">t_arena</a>* <a class="code hl_function" href="group__arena__scratch.html#ga244f078e83929f392e441ca375c2230a">scratch_acquire</a>(<a class="code hl_struct" href="group__arena__scratch.html#structs__scratch__arena__pool">t_scratch_arena_pool</a>* pool)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!pool)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_acquire failed: pool is NULL&quot;</span>), NULL;</div>
<div class="line"> </div>
<div class="line">    <a id="a17" name="a17"></a><a class="code hl_define" href="arena__scratch_8h.html#abce4c0e1d69d3b9850e36d69968c2d64">SCRATCH_LOCK</a>(pool);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!atomic_exchange(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a id="a18" name="a18"></a><a class="code hl_variable" href="group__arena__scratch__internal.html#a52279bc596790848ee8b4c00064f3782">in_use</a>, <span class="keyword">true</span>))</div>
<div class="line">        {</div>
<div class="line">            <a id="a19" name="a19"></a><a class="code hl_function" href="arena_8h.html#a1a2582ca5fb4e571ac150fbd77bd0d82">arena_reset</a>(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a>);</div>
<div class="line">            <a id="a20" name="a20"></a><a class="code hl_define" href="arena__scratch_8h.html#a2f8510d38c4a460a6defc40c47e197dd">SCRATCH_UNLOCK</a>(pool);</div>
<div class="line">            <span class="keywordflow">return</span> &amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_define" href="arena__scratch_8h.html#a2f8510d38c4a460a6defc40c47e197dd">SCRATCH_UNLOCK</a>(pool);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_acquire failed: all slots in use&quot;</span>), NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="group__arena__scratch.html#gade0c7f0a1b88c47211db8f2c9f3f3660">scratch_release</a>(<a class="code hl_struct" href="group__arena__scratch.html#structs__scratch__arena__pool">t_scratch_arena_pool</a>* pool, <a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!pool || !arena)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_release failed: null pool or arena&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a>; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a> == arena)</div>
<div class="line">        {</div>
<div class="line">            atomic_store(&amp;pool-&gt;<a class="code hl_variable" href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">slots</a>[i].<a class="code hl_variable" href="group__arena__scratch__internal.html#a52279bc596790848ee8b4c00064f3782">in_use</a>, <span class="keyword">false</span>);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(arena, <span class="stringliteral">&quot;scratch_release failed: arena not found in pool&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * INTERNAL HELPER</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="group__arena__scratch__internal.html#gae37e23cb6b3d190982157208a850d840">scratch_slot_init</a>(<a class="code hl_struct" href="group__arena__scratch__internal.html#structs__scratch__slot">t_scratch_slot</a>* slot, <span class="keywordtype">size_t</span> slot_size, <span class="keywordtype">int</span> index)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!<a id="a21" name="a21"></a><a class="code hl_function" href="arena_8h.html#a245dff47ef4fe5693b657a42deecf988">arena_init</a>(&amp;slot-&gt;<a class="code hl_variable" href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">arena</a>, slot_size, <span class="keyword">true</span>))</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;scratch_slot_init failed: arena_init failed for slot %d&quot;</span>, index);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    atomic_store(&amp;slot-&gt;<a class="code hl_variable" href="group__arena__scratch__internal.html#a52279bc596790848ee8b4c00064f3782">in_use</a>, <span class="keyword">false</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aarena_8h_html_a1a2582ca5fb4e571ac150fbd77bd0d82"><div class="ttname"><a href="arena_8h.html#a1a2582ca5fb4e571ac150fbd77bd0d82">arena_reset</a></div><div class="ttdeci">void arena_reset(t_arena *arena)</div><div class="ttdef"><b>Definition</b> <a href="arena__state_8c_source.html#l00345">arena_state.c:345</a></div></div>
<div class="ttc" id="aarena_8h_html_a245dff47ef4fe5693b657a42deecf988"><div class="ttname"><a href="arena_8h.html#a245dff47ef4fe5693b657a42deecf988">arena_init</a></div><div class="ttdeci">bool arena_init(t_arena *arena, size_t size, bool allow_grow)</div><div class="ttdef"><b>Definition</b> <a href="arena__create_8c_source.html#l00190">arena_create.c:190</a></div></div>
<div class="ttc" id="aarena_8h_html_a640f54190aa0b356bc55787bfde1dcc5"><div class="ttname"><a href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a></div><div class="ttdeci">void arena_destroy(t_arena *arena)</div><div class="ttdef"><b>Definition</b> <a href="arena__cleanup_8c_source.html#l00082">arena_cleanup.c:82</a></div></div>
<div class="ttc" id="aarena__debug_8h_html_ad19e051bc49dc6b6dcda0f31561e222d"><div class="ttname"><a href="arena__debug_8h.html#ad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a></div><div class="ttdeci">void arena_report_error(t_arena *arena, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="arena__debug_8c_source.html#l00253">arena_debug.c:253</a></div></div>
<div class="ttc" id="aarena__scratch_8h_html_a2f8510d38c4a460a6defc40c47e197dd"><div class="ttname"><a href="arena__scratch_8h.html#a2f8510d38c4a460a6defc40c47e197dd">SCRATCH_UNLOCK</a></div><div class="ttdeci">#define SCRATCH_UNLOCK(pool)</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00055">arena_scratch.h:55</a></div></div>
<div class="ttc" id="aarena__scratch_8h_html_a7896fb10ff84dd7be54082cf4c301829"><div class="ttname"><a href="arena__scratch_8h.html#a7896fb10ff84dd7be54082cf4c301829">SCRATCH_MAX_SLOTS</a></div><div class="ttdeci">#define SCRATCH_MAX_SLOTS</div><div class="ttdoc">Maximum number of concurrently usable scratch arenas in the pool.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00041">arena_scratch.h:41</a></div></div>
<div class="ttc" id="aarena__scratch_8h_html_abce4c0e1d69d3b9850e36d69968c2d64"><div class="ttname"><a href="arena__scratch_8h.html#abce4c0e1d69d3b9850e36d69968c2d64">SCRATCH_LOCK</a></div><div class="ttdeci">#define SCRATCH_LOCK(pool)</div><div class="ttdoc">Thread-safe locking macro (enabled only if ARENA_ENABLE_THREAD_SAFE is set)</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00054">arena_scratch.h:54</a></div></div>
<div class="ttc" id="agroup__arena__scratch__internal_html_a52279bc596790848ee8b4c00064f3782"><div class="ttname"><a href="group__arena__scratch__internal.html#a52279bc596790848ee8b4c00064f3782">s_scratch_slot::in_use</a></div><div class="ttdeci">atomic_bool in_use</div><div class="ttdoc">Atomic flag for acquisition tracking.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00076">arena_scratch.h:76</a></div></div>
<div class="ttc" id="agroup__arena__scratch__internal_html_a8e53aefa580a0552977802026307e540"><div class="ttname"><a href="group__arena__scratch__internal.html#a8e53aefa580a0552977802026307e540">s_scratch_slot::arena</a></div><div class="ttdeci">t_arena arena</div><div class="ttdoc">Memory arena associated with this slot.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00075">arena_scratch.h:75</a></div></div>
<div class="ttc" id="agroup__arena__scratch__internal_html_gae37e23cb6b3d190982157208a850d840"><div class="ttname"><a href="group__arena__scratch__internal.html#gae37e23cb6b3d190982157208a850d840">scratch_slot_init</a></div><div class="ttdeci">static bool scratch_slot_init(t_scratch_slot *slot, size_t slot_size, int index)</div><div class="ttdoc">Initialize a single scratch slot with its own arena.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8c_source.html#l00449">arena_scratch.c:449</a></div></div>
<div class="ttc" id="agroup__arena__scratch__internal_html_structs__scratch__slot"><div class="ttname"><a href="group__arena__scratch__internal.html#structs__scratch__slot">s_scratch_slot</a></div><div class="ttdoc">Represents a single slot in the scratch arena pool.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00073">arena_scratch.h:74</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_a64c052156b441b7adf46af210b8fcf95"><div class="ttname"><a href="group__arena__scratch.html#a64c052156b441b7adf46af210b8fcf95">s_scratch_arena_pool::slot_size</a></div><div class="ttdeci">size_t slot_size</div><div class="ttdoc">Size of each arena in bytes.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00092">arena_scratch.h:92</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_a6504b8d51c2b438853b18f89cb70d9a0"><div class="ttname"><a href="group__arena__scratch.html#a6504b8d51c2b438853b18f89cb70d9a0">s_scratch_arena_pool::lock</a></div><div class="ttdeci">pthread_mutex_t lock</div><div class="ttdoc">Mutex for protecting slot access.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00094">arena_scratch.h:94</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_aa36226e6da3d33e85c2f2bbebce6585c"><div class="ttname"><a href="group__arena__scratch.html#aa36226e6da3d33e85c2f2bbebce6585c">s_scratch_arena_pool::slots</a></div><div class="ttdeci">t_scratch_slot slots[SCRATCH_MAX_SLOTS]</div><div class="ttdoc">Array of scratch slots.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00091">arena_scratch.h:91</a></div></div>
<div class="ttc" id="agroup__arena__scratch_html_af715e967b0a60c4da8500be7d3ac7ca3"><div class="ttname"><a href="group__arena__scratch.html#af715e967b0a60c4da8500be7d3ac7ca3">s_scratch_arena_pool::thread_safe</a></div><div class="ttdeci">bool thread_safe</div><div class="ttdoc">Whether locking is enabled.</div><div class="ttdef"><b>Definition</b> <a href="arena__scratch_8h_source.html#l00093">arena_scratch.h:93</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
