<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>memory_arena: /home/toonsa/myProjects/memoryArena/srcs/core/arena_create.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">memory_arena
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">/home/toonsa/myProjects/memoryArena/srcs/core/arena_create.c</div></div>
</div><!--header-->
<div class="contents">
<p>Allocate and initialize a dynamic arena with an internal buffer.</p>
<p>Allocate and initialize a dynamic arena with an internal buffer.This is the main constructor-style function for creating a new <code><a class="el" href="structt__arena.html" title="The main memory arena structure used for fast allocation.">t_arena</a></code> on the heap. It performs both the allocation of the arena <b>structure</b> itself and a fresh internal memory buffer of the requested size. It then initializes metadata, locking (if enabled), and a unique ID.</p>
<p>Use this when:</p><ul>
<li>You want the arena struct and its buffer to be fully heap-allocated.</li>
<li>You want to manage the arena via a pointer and destroy/free it dynamically.</li>
<li>You prefer a simplified interface without manually supplying memory.</li>
</ul>
<p>It performs:</p><ul>
<li>A check for invalid size (must be non-zero).</li>
<li>A call to <code><a class="el" href="group__arena__internal.html#gaf3f69ef616d39542b2f9d81f954998cd" title="Allocate and zero-initialize a new arena struct.">arena_alloc_struct()</a></code> to create the arena.</li>
<li>A call to <code><a class="el" href="group__arena__internal.html#ga6bcc9b8d8f8dcac0c269eccc0b8cf8d2" title="Allocate a zero-initialized memory buffer for the arena.">arena_alloc_buffer()</a></code> to allocate zeroed memory.</li>
<li>Initialization via <code><a class="el" href="group__arena__internal.html#ga2dcc4e3f99d12e69a37bac4cf5401b63" title="Finalize the initialization of an arena with a provided buffer.">arena_finish_init()</a></code> and setup of a default debug label.</li>
</ul>
<p>If any step fails, the function cleans up and returns <code>NULL</code>, with error reporting.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>Size (in bytes) of the internal memory buffer. </td></tr>
    <tr><td class="paramname">allow_grow</td><td>Whether the arena is allowed to grow dynamically if needed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to a fully initialized <code><a class="el" href="structt__arena.html" title="The main memory arena structure used for fast allocation.">t_arena</a></code>, or <code>NULL</code> on failure.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The returned arena must be destroyed with <code><a class="el" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy()</a></code> and freed with <code><a class="el" href="arena_8h.html#a7821a62eaf6d9f982322e49eaf6153e8">arena_delete()</a></code>. Use <code><a class="el" href="arena__create_8c.html#a245dff47ef4fe5693b657a42deecf988">arena_init()</a></code> instead if you have a statically or stack-allocated arena struct.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="arena__create_8c.html#a245dff47ef4fe5693b657a42deecf988">arena_init</a> </dd>
<dd>
<a class="el" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a> </dd>
<dd>
<a class="el" href="arena_8h.html#a7821a62eaf6d9f982322e49eaf6153e8">arena_delete</a></dd></dl>
<div class="fragment"><div class="line"><a id="_a0" name="_a0"></a><a class="code hl_struct" href="structt__arena.html">t_arena</a>* heap_arena = <a id="a1" name="a1"></a><a class="code hl_function" href="arena_8h.html#ad623b3dfc5761c29d44f78c58821c932">arena_create</a>(16384, <span class="keyword">true</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!heap_arena) {</div>
<div class="line">    <span class="comment">// handle error</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span>* ptr = <a id="a2" name="a2"></a><a class="code hl_function" href="arena_8h.html#a1def00c6156e8df19f0a1af7cd6f26dd">arena_alloc</a>(heap_arena, 512);</div>
<div class="line"><a id="a3" name="a3"></a><a class="code hl_function" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a>(heap_arena);</div>
<div class="line"><a id="a4" name="a4"></a><a class="code hl_function" href="arena_8h.html#a7821a62eaf6d9f982322e49eaf6153e8">arena_delete</a>(&amp;heap_arena);</div>
<div class="ttc" id="aarena_8h_html_a1def00c6156e8df19f0a1af7cd6f26dd"><div class="ttname"><a href="arena_8h.html#a1def00c6156e8df19f0a1af7cd6f26dd">arena_alloc</a></div><div class="ttdeci">void * arena_alloc(t_arena *arena, size_t size)</div><div class="ttdef"><b>Definition</b> arena_alloc.c:112</div></div>
<div class="ttc" id="aarena_8h_html_a640f54190aa0b356bc55787bfde1dcc5"><div class="ttname"><a href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a></div><div class="ttdeci">void arena_destroy(t_arena *arena)</div><div class="ttdef"><b>Definition</b> arena_cleanup.c:82</div></div>
<div class="ttc" id="aarena_8h_html_a7821a62eaf6d9f982322e49eaf6153e8"><div class="ttname"><a href="arena_8h.html#a7821a62eaf6d9f982322e49eaf6153e8">arena_delete</a></div><div class="ttdeci">void arena_delete(t_arena **arena)</div><div class="ttdef"><b>Definition</b> arena_cleanup.c:148</div></div>
<div class="ttc" id="aarena_8h_html_ad623b3dfc5761c29d44f78c58821c932"><div class="ttname"><a href="arena_8h.html#ad623b3dfc5761c29d44f78c58821c932">arena_create</a></div><div class="ttdeci">t_arena * arena_create(size_t size, bool allow_grow)</div><div class="ttdef"><b>Definition</b> arena_create.c:111</div></div>
<div class="ttc" id="astructt__arena_html"><div class="ttname"><a href="structt__arena.html">t_arena</a></div><div class="ttdoc">The main memory arena structure used for fast allocation.</div></div>
</div><!-- fragment --><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="arena_8h.html">arena.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdatomic.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * INTERNAL FUNCTION DECLARATIONS</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>     <a id="a5" name="a5"></a><a class="code hl_function" href="group__arena__internal.html#ga9460f83f6dae2993ccbd6a388944bf7c">arena_set_default_label</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keyword">const</span> <span class="keywordtype">char</span>* fallback);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structt__arena.html">t_arena</a>* <a id="a6" name="a6"></a><a class="code hl_function" href="group__arena__internal.html#gaf3f69ef616d39542b2f9d81f954998cd">arena_alloc_struct</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>     <a id="a7" name="a7"></a><a class="code hl_function" href="group__arena__internal.html#ga2d9a7cc2eb2dd849843b312892303c71">arena_log_and_teardown</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>** arena, <span class="keyword">const</span> <span class="keywordtype">char</span>* msg);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>*    <a id="a8" name="a8"></a><a class="code hl_function" href="group__arena__internal.html#ga6bcc9b8d8f8dcac0c269eccc0b8cf8d2">arena_alloc_buffer</a>(<span class="keywordtype">size_t</span> size);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>     <a id="a9" name="a9"></a><a class="code hl_function" href="group__arena__internal.html#ga158ae1db776df1d113e7cddff4c9ca2f">arena_reset_metadata</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a id="a10" name="a10"></a><a class="code hl_function" href="group__arena__internal.html#ga9b703d033342ea54cf18d08eac74d5b1">arena_init_mutex</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a id="a11" name="a11"></a><a class="code hl_function" href="group__arena__internal.html#ga2dcc4e3f99d12e69a37bac4cf5401b63">arena_finish_init</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size, <span class="keywordtype">bool</span> allow_grow);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a id="a12" name="a12"></a><a class="code hl_function" href="group__arena__internal.html#ga8e94425910ed0ce27fd21cda3937ad56">arena_set_allocated_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">size_t</span> size);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>     <a id="a13" name="a13"></a><a class="code hl_function" href="group__arena__internal.html#ga1d3f6bfa8145e31ab67a0cf9bce5f222">arena_set_user_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a id="a14" name="a14"></a><a class="code hl_function" href="group__arena__internal.html#ga5f5cec8e7ef56c3bf1ec9336e54f1a48">arena_set_or_alloc_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * PUBLIC API</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structt__arena.html">t_arena</a>* <a class="code hl_function" href="arena_8h.html#ad623b3dfc5761c29d44f78c58821c932">arena_create</a>(<span class="keywordtype">size_t</span> size, <span class="keywordtype">bool</span> allow_grow)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (size == 0)</div>
<div class="line">    {</div>
<div class="line">        <a id="a15" name="a15"></a><a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;arena_create failed: zero size requested&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena = <a class="code hl_function" href="group__arena__internal.html#gaf3f69ef616d39542b2f9d81f954998cd">arena_alloc_struct</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (!arena)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span>* buffer = <a class="code hl_function" href="group__arena__internal.html#ga6bcc9b8d8f8dcac0c269eccc0b8cf8d2">arena_alloc_buffer</a>(size);</div>
<div class="line">    <span class="keywordflow">if</span> (!buffer)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__internal.html#ga2d9a7cc2eb2dd849843b312892303c71">arena_log_and_teardown</a>(&amp;arena, <span class="stringliteral">&quot;arena_create: buffer allocation failed&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__internal.html#ga2dcc4e3f99d12e69a37bac4cf5401b63">arena_finish_init</a>(arena, buffer, size, allow_grow))</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__internal.html#ga2d9a7cc2eb2dd849843b312892303c71">arena_log_and_teardown</a>(&amp;arena, <span class="stringliteral">&quot;arena_create: init failure&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__arena__internal.html#ga9460f83f6dae2993ccbd6a388944bf7c">arena_set_default_label</a>(arena, <span class="stringliteral">&quot;arena_heap&quot;</span>);</div>
<div class="line">    <a id="a16" name="a16"></a><a class="code hl_function" href="group__arena__debug.html#ga04a9de28f7c7ffe93039cce9927ac875">arena_generate_id</a>(arena);</div>
<div class="line">    <span class="keywordflow">return</span> arena;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a id="a17" name="a17"></a><a class="code hl_function" href="arena_8h.html#a245dff47ef4fe5693b657a42deecf988">arena_init</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">size_t</span> size, <span class="keywordtype">bool</span> allow_grow)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!arena || size == 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;arena_init failed: invalid arena or size&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span>* buffer = <a class="code hl_function" href="group__arena__internal.html#ga6bcc9b8d8f8dcac0c269eccc0b8cf8d2">arena_alloc_buffer</a>(size);</div>
<div class="line">    <span class="keywordflow">if</span> (!buffer)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__internal.html#ga2d9a7cc2eb2dd849843b312892303c71">arena_log_and_teardown</a>(&amp;arena, <span class="stringliteral">&quot;arena_init: buffer allocation failed&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__internal.html#ga2dcc4e3f99d12e69a37bac4cf5401b63">arena_finish_init</a>(arena, buffer, size, allow_grow))</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(arena, <span class="stringliteral">&quot;arena_init: arena_finish_init failed&quot;</span>);</div>
<div class="line">        free(buffer);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__arena__internal.html#ga9460f83f6dae2993ccbd6a388944bf7c">arena_set_default_label</a>(arena, <span class="stringliteral">&quot;arena_stack&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="group__arena__debug.html#ga04a9de28f7c7ffe93039cce9927ac875">arena_generate_id</a>(arena);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a18" name="a18"></a><a class="code hl_function" href="arena_8h.html#a4a0d8e453e26366da91c18877495ad42">arena_init_with_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size, <span class="keywordtype">bool</span> allow_grow)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!arena)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;arena_init_with_buffer: NULL arena&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__arena__internal.html#ga158ae1db776df1d113e7cddff4c9ca2f">arena_reset_metadata</a>(arena);</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;can_grow, allow_grow, memory_order_release);</div>
<div class="line">    <a class="code hl_function" href="group__arena__internal.html#ga9b703d033342ea54cf18d08eac74d5b1">arena_init_mutex</a>(arena);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__internal.html#ga5f5cec8e7ef56c3bf1ec9336e54f1a48">arena_set_or_alloc_buffer</a>(arena, buffer, size))</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__arena__internal.html#ga9460f83f6dae2993ccbd6a388944bf7c">arena_set_default_label</a>(arena, <span class="stringliteral">&quot;arena_from_buffer&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="group__arena__debug.html#ga04a9de28f7c7ffe93039cce9927ac875">arena_generate_id</a>(arena);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a id="a19" name="a19"></a><a class="code hl_function" href="arena_8h.html#ab4a51df7e56b31156d46bbe201b39b2a">arena_reinit_with_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size, <span class="keywordtype">bool</span> allow_grow)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a>(arena);</div>
<div class="line">    <a class="code hl_function" href="arena_8h.html#a4a0d8e453e26366da91c18877495ad42">arena_init_with_buffer</a>(arena, buffer, size, allow_grow);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * INTERNAL HELPERS (static inline)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="group__arena__internal.html#ga9460f83f6dae2993ccbd6a388944bf7c">arena_set_default_label</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keyword">const</span> <span class="keywordtype">char</span>* fallback)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!arena-&gt;debug.label)</div>
<div class="line">        arena-&gt;debug.label = fallback;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structt__arena.html">t_arena</a>* <a class="code hl_function" href="group__arena__internal.html#gaf3f69ef616d39542b2f9d81f954998cd">arena_alloc_struct</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (<a class="code hl_struct" href="structt__arena.html">t_arena</a>*) calloc(1, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="group__arena__internal.html#ga2d9a7cc2eb2dd849843b312892303c71">arena_log_and_teardown</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>** arena, <span class="keyword">const</span> <span class="keywordtype">char</span>* msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!arena || !*arena)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;%s&quot;</span>, msg);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(*arena, <span class="stringliteral">&quot;%s&quot;</span>, msg);</div>
<div class="line">    <a class="code hl_function" href="arena_8h.html#a640f54190aa0b356bc55787bfde1dcc5">arena_destroy</a>(*arena);</div>
<div class="line">    <a class="code hl_function" href="arena_8h.html#a7821a62eaf6d9f982322e49eaf6153e8">arena_delete</a>(arena);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>* <a class="code hl_function" href="group__arena__internal.html#ga6bcc9b8d8f8dcac0c269eccc0b8cf8d2">arena_alloc_buffer</a>(<span class="keywordtype">size_t</span> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span>* buffer = calloc(1, size);</div>
<div class="line">    <span class="keywordflow">if</span> (!buffer)</div>
<div class="line">        <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;arena_create failed: buffer allocation of %zu bytes failed&quot;</span>, size);</div>
<div class="line">    <span class="keywordflow">return</span> buffer;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="group__arena__internal.html#ga158ae1db776df1d113e7cddff4c9ca2f">arena_reset_metadata</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena)</div>
<div class="line">{</div>
<div class="line">    arena-&gt;buffer           = NULL;</div>
<div class="line">    arena-&gt;size             = 0;</div>
<div class="line">    arena-&gt;offset           = 0;</div>
<div class="line">    arena-&gt;marker_stack_top = 0;</div>
<div class="line">    memset(arena-&gt;marker_stack, 0, <span class="keyword">sizeof</span>(arena-&gt;marker_stack));</div>
<div class="line">    arena-&gt;parent_ref = NULL;</div>
<div class="line"> </div>
<div class="line">    arena-&gt;grow_cb             = <a id="a20" name="a20"></a><a class="code hl_function" href="group__arena__internal.html#ga627d4fdc46e225dccde0388ae40d04de">default_grow_cb</a>;</div>
<div class="line">    arena-&gt;debug.error_cb      = <a id="a21" name="a21"></a><a class="code hl_function" href="group__arena__debug.html#ga3e58b128a2f84c4ed41102243bf38634">arena_default_error_callback</a>;</div>
<div class="line">    arena-&gt;debug.error_context = NULL;</div>
<div class="line">    arena-&gt;debug.label         = NULL;</div>
<div class="line"> </div>
<div class="line">    arena-&gt;hooks.hook_cb = NULL;</div>
<div class="line">    arena-&gt;hooks.context = NULL;</div>
<div class="line"> </div>
<div class="line">    <a id="a22" name="a22"></a><a class="code hl_function" href="group__arena__stats.html#ga158f6a0623850d3dc681d9ecab1fe27f">arena_stats_reset</a>(&amp;arena-&gt;stats);</div>
<div class="line"> </div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;owns_buffer, <span class="keyword">false</span>, memory_order_release);</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;can_grow, <span class="keyword">false</span>, memory_order_release);</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;is_destroying, <span class="keyword">false</span>, memory_order_release);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line">    arena-&gt;use_lock = <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="group__arena__internal.html#ga9b703d033342ea54cf18d08eac74d5b1">arena_init_mutex</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef ARENA_ENABLE_THREAD_SAFE</span></div>
<div class="line">    pthread_mutexattr_t attr;</div>
<div class="line">    <span class="keywordflow">if</span> (pthread_mutexattr_init(&amp;attr) != 0)</div>
<div class="line">        <span class="keywordflow">goto</span> fail;</div>
<div class="line">    <span class="keywordflow">if</span> (pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE) != 0)</div>
<div class="line">        <span class="keywordflow">goto</span> fail_attr;</div>
<div class="line">    <span class="keywordflow">if</span> (pthread_mutex_init(&amp;arena-&gt;lock, &amp;attr) != 0)</div>
<div class="line">        <span class="keywordflow">goto</span> fail_attr;</div>
<div class="line">    pthread_mutexattr_destroy(&amp;attr);</div>
<div class="line">    arena-&gt;use_lock = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">fail_attr:</div>
<div class="line">    pthread_mutexattr_destroy(&amp;attr);</div>
<div class="line">fail:</div>
<div class="line">    <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;arena_create failed: mutex setup failed&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    (void) arena;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="group__arena__internal.html#ga2dcc4e3f99d12e69a37bac4cf5401b63">arena_finish_init</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size, <span class="keywordtype">bool</span> allow_grow)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="group__arena__internal.html#ga158ae1db776df1d113e7cddff4c9ca2f">arena_reset_metadata</a>(arena);</div>
<div class="line">    arena-&gt;buffer = (uint8_t*) buffer;</div>
<div class="line">    arena-&gt;size   = size;</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;owns_buffer, <span class="keyword">true</span>, memory_order_release);</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;can_grow, allow_grow, memory_order_release);</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;is_destroying, <span class="keyword">false</span>, memory_order_release);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__arena__internal.html#ga9b703d033342ea54cf18d08eac74d5b1">arena_init_mutex</a>(arena))</div>
<div class="line">    {</div>
<div class="line">        free(buffer);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_function" href="group__arena__debug.html#ga04a9de28f7c7ffe93039cce9927ac875">arena_generate_id</a>(arena);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="group__arena__internal.html#ga8e94425910ed0ce27fd21cda3937ad56">arena_set_allocated_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">size_t</span> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span>* buffer = calloc(1, size);</div>
<div class="line">    <span class="keywordflow">if</span> (!buffer)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a>(NULL, <span class="stringliteral">&quot;arena_init_with_buffer: malloc for %zu bytes failed&quot;</span>, size);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    arena-&gt;buffer = (uint8_t*) buffer;</div>
<div class="line">    arena-&gt;size   = size;</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;owns_buffer, <span class="keyword">true</span>, memory_order_release);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="group__arena__internal.html#ga1d3f6bfa8145e31ab67a0cf9bce5f222">arena_set_user_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size)</div>
<div class="line">{</div>
<div class="line">    arena-&gt;buffer = (uint8_t*) buffer;</div>
<div class="line">    arena-&gt;size   = size;</div>
<div class="line">    atomic_store_explicit(&amp;arena-&gt;owns_buffer, <span class="keyword">false</span>, memory_order_release);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="group__arena__internal.html#ga5f5cec8e7ef56c3bf1ec9336e54f1a48">arena_set_or_alloc_buffer</a>(<a class="code hl_struct" href="structt__arena.html">t_arena</a>* arena, <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> size)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!buffer &amp;&amp; size &gt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_function" href="group__arena__internal.html#ga8e94425910ed0ce27fd21cda3937ad56">arena_set_allocated_buffer</a>(arena, size);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__arena__internal.html#ga1d3f6bfa8145e31ab67a0cf9bce5f222">arena_set_user_buffer</a>(arena, buffer, size);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aarena_8h_html"><div class="ttname"><a href="arena_8h.html">arena.h</a></div><div class="ttdoc">Core public API for the Arena memory allocator.</div></div>
<div class="ttc" id="aarena_8h_html_a245dff47ef4fe5693b657a42deecf988"><div class="ttname"><a href="arena_8h.html#a245dff47ef4fe5693b657a42deecf988">arena_init</a></div><div class="ttdeci">bool arena_init(t_arena *arena, size_t size, bool allow_grow)</div><div class="ttdef"><b>Definition</b> arena_create.c:190</div></div>
<div class="ttc" id="aarena_8h_html_a4a0d8e453e26366da91c18877495ad42"><div class="ttname"><a href="arena_8h.html#a4a0d8e453e26366da91c18877495ad42">arena_init_with_buffer</a></div><div class="ttdeci">void arena_init_with_buffer(t_arena *arena, void *buffer, size_t size, bool allow_grow)</div><div class="ttdef"><b>Definition</b> arena_create.c:286</div></div>
<div class="ttc" id="aarena_8h_html_ab4a51df7e56b31156d46bbe201b39b2a"><div class="ttname"><a href="arena_8h.html#ab4a51df7e56b31156d46bbe201b39b2a">arena_reinit_with_buffer</a></div><div class="ttdeci">void arena_reinit_with_buffer(t_arena *arena, void *buffer, size_t size, bool allow_grow)</div><div class="ttdef"><b>Definition</b> arena_create.c:361</div></div>
<div class="ttc" id="agroup__arena__debug_html_ga04a9de28f7c7ffe93039cce9927ac875"><div class="ttname"><a href="group__arena__debug.html#ga04a9de28f7c7ffe93039cce9927ac875">arena_generate_id</a></div><div class="ttdeci">void arena_generate_id(t_arena *arena)</div><div class="ttdoc">Generate a unique debug ID for an arena.</div><div class="ttdef"><b>Definition</b> arena_debug.c:102</div></div>
<div class="ttc" id="agroup__arena__debug_html_ga3e58b128a2f84c4ed41102243bf38634"><div class="ttname"><a href="group__arena__debug.html#ga3e58b128a2f84c4ed41102243bf38634">arena_default_error_callback</a></div><div class="ttdeci">void arena_default_error_callback(const char *msg, void *ctx)</div><div class="ttdoc">Default fallback error callback (prints to stderr).</div><div class="ttdef"><b>Definition</b> arena_debug.c:310</div></div>
<div class="ttc" id="agroup__arena__debug_html_gad19e051bc49dc6b6dcda0f31561e222d"><div class="ttname"><a href="group__arena__debug.html#gad19e051bc49dc6b6dcda0f31561e222d">arena_report_error</a></div><div class="ttdeci">void arena_report_error(t_arena *arena, const char *fmt,...)</div><div class="ttdoc">Report an error from an arena using its configured error callback.</div><div class="ttdef"><b>Definition</b> arena_debug.c:253</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga158ae1db776df1d113e7cddff4c9ca2f"><div class="ttname"><a href="group__arena__internal.html#ga158ae1db776df1d113e7cddff4c9ca2f">arena_reset_metadata</a></div><div class="ttdeci">static void arena_reset_metadata(t_arena *arena)</div><div class="ttdoc">Reset all arena metadata fields to their default initial state.</div><div class="ttdef"><b>Definition</b> arena_create.c:530</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga1d3f6bfa8145e31ab67a0cf9bce5f222"><div class="ttname"><a href="group__arena__internal.html#ga1d3f6bfa8145e31ab67a0cf9bce5f222">arena_set_user_buffer</a></div><div class="ttdeci">static void arena_set_user_buffer(t_arena *arena, void *buffer, size_t size)</div><div class="ttdoc">Assign a user-provided buffer to an arena without taking ownership.</div><div class="ttdef"><b>Definition</b> arena_create.c:719</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga2d9a7cc2eb2dd849843b312892303c71"><div class="ttname"><a href="group__arena__internal.html#ga2d9a7cc2eb2dd849843b312892303c71">arena_log_and_teardown</a></div><div class="ttdeci">static void arena_log_and_teardown(t_arena **arena, const char *msg)</div><div class="ttdoc">Report an error, destroy the arena, and free its memory.</div><div class="ttdef"><b>Definition</b> arena_create.c:458</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga2dcc4e3f99d12e69a37bac4cf5401b63"><div class="ttname"><a href="group__arena__internal.html#ga2dcc4e3f99d12e69a37bac4cf5401b63">arena_finish_init</a></div><div class="ttdeci">static bool arena_finish_init(t_arena *arena, void *buffer, size_t size, bool allow_grow)</div><div class="ttdoc">Finalize the initialization of an arena with a provided buffer.</div><div class="ttdef"><b>Definition</b> arena_create.c:640</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga5f5cec8e7ef56c3bf1ec9336e54f1a48"><div class="ttname"><a href="group__arena__internal.html#ga5f5cec8e7ef56c3bf1ec9336e54f1a48">arena_set_or_alloc_buffer</a></div><div class="ttdeci">static bool arena_set_or_alloc_buffer(t_arena *arena, void *buffer, size_t size)</div><div class="ttdoc">Configure an arena's buffer by either assigning a user-provided region or allocating one internally.</div><div class="ttdef"><b>Definition</b> arena_create.c:750</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga627d4fdc46e225dccde0388ae40d04de"><div class="ttname"><a href="group__arena__internal.html#ga627d4fdc46e225dccde0388ae40d04de">default_grow_cb</a></div><div class="ttdeci">size_t default_grow_cb(size_t current_size, size_t requested_size)</div><div class="ttdoc">Default growth policy callback for arena resizing.</div><div class="ttdef"><b>Definition</b> arena_internal.c:78</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga6bcc9b8d8f8dcac0c269eccc0b8cf8d2"><div class="ttname"><a href="group__arena__internal.html#ga6bcc9b8d8f8dcac0c269eccc0b8cf8d2">arena_alloc_buffer</a></div><div class="ttdeci">static void * arena_alloc_buffer(size_t size)</div><div class="ttdoc">Allocate a zero-initialized memory buffer for the arena.</div><div class="ttdef"><b>Definition</b> arena_create.c:492</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga8e94425910ed0ce27fd21cda3937ad56"><div class="ttname"><a href="group__arena__internal.html#ga8e94425910ed0ce27fd21cda3937ad56">arena_set_allocated_buffer</a></div><div class="ttdeci">static bool arena_set_allocated_buffer(t_arena *arena, size_t size)</div><div class="ttdoc">Allocate and assign a zero-initialized buffer to an arena.</div><div class="ttdef"><b>Definition</b> arena_create.c:682</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga9460f83f6dae2993ccbd6a388944bf7c"><div class="ttname"><a href="group__arena__internal.html#ga9460f83f6dae2993ccbd6a388944bf7c">arena_set_default_label</a></div><div class="ttdeci">static void arena_set_default_label(t_arena *arena, const char *fallback)</div><div class="ttdoc">Set a fallback debug label if none is set.</div><div class="ttdef"><b>Definition</b> arena_create.c:398</div></div>
<div class="ttc" id="agroup__arena__internal_html_ga9b703d033342ea54cf18d08eac74d5b1"><div class="ttname"><a href="group__arena__internal.html#ga9b703d033342ea54cf18d08eac74d5b1">arena_init_mutex</a></div><div class="ttdeci">static bool arena_init_mutex(t_arena *arena)</div><div class="ttdoc">Initialize the mutex used for thread-safe arena operations.</div><div class="ttdef"><b>Definition</b> arena_create.c:585</div></div>
<div class="ttc" id="agroup__arena__internal_html_gaf3f69ef616d39542b2f9d81f954998cd"><div class="ttname"><a href="group__arena__internal.html#gaf3f69ef616d39542b2f9d81f954998cd">arena_alloc_struct</a></div><div class="ttdeci">static t_arena * arena_alloc_struct(void)</div><div class="ttdoc">Allocate and zero-initialize a new arena struct.</div><div class="ttdef"><b>Definition</b> arena_create.c:426</div></div>
<div class="ttc" id="agroup__arena__stats_html_ga158f6a0623850d3dc681d9ecab1fe27f"><div class="ttname"><a href="group__arena__stats.html#ga158f6a0623850d3dc681d9ecab1fe27f">arena_stats_reset</a></div><div class="ttdeci">void arena_stats_reset(t_arena_stats *stats)</div><div class="ttdoc">Reset the given statistics structure to zero.</div><div class="ttdef"><b>Definition</b> arena_internal.c:187</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
